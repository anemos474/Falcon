"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.AddressFormFields = void 0;

var _extends2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/extends"));

var _react = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("react"));

var _formik = /*#__PURE__*/require("formik");

var _falconI18n = /*#__PURE__*/require("@deity/falcon-i18n");

var _falconShopData = /*#__PURE__*/require("@deity/falcon-shop-data");

var _falconUi = /*#__PURE__*/require("@deity/falcon-ui");

var _Forms = /*#__PURE__*/require("../Forms");

var _Layouts = /*#__PURE__*/require("../Layouts");

var _Country = /*#__PURE__*/require("../Country");

var _Loader = /*#__PURE__*/require("../Loader");

var AddressFormFields = function AddressFormFields(props) {
  var twoColumns = props.twoColumns,
      askDefault = props.askDefault,
      askEmail = props.askEmail,
      autoCompleteSection = props.autoCompleteSection;

  var _useI18n = (0, _falconI18n.useI18n)(),
      t = _useI18n.t;

  var _useField = (0, _formik.useField)('country'),
      selectedCountry = _useField[0].value;

  var getAutoComplete = function getAutoComplete(attribute) {
    return [autoCompleteSection, attribute].filter(Boolean).join(' ');
  };

  var askDefaultFields = /*#__PURE__*/_react.default.createElement(_falconUi.Box, {
    mb: "sm"
  }, /*#__PURE__*/_react.default.createElement(_Forms.CheckboxFormField, {
    name: "defaultShipping"
  }), /*#__PURE__*/_react.default.createElement(_Forms.CheckboxFormField, {
    name: "defaultBilling"
  })); // the form content, not including default address fields and submit button(s)


  var mainContent = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_falconUi.GridLayout, {
    gridArea: twoColumns ? _Layouts.TwoColumnsLayoutArea.left : null
  }, askEmail && /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "email",
    type: "email",
    required: true
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "company",
    autoComplete: getAutoComplete('company')
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "firstname",
    required: true,
    autoComplete: getAutoComplete('given-name')
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "lastname",
    required: true,
    autoComplete: getAutoComplete('family-name')
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "telephone",
    required: true,
    autoComplete: getAutoComplete('tel')
  })), /*#__PURE__*/_react.default.createElement(_falconUi.GridLayout, {
    gridArea: twoColumns ? _Layouts.TwoColumnsLayoutArea.right : null
  }, /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "street1",
    required: true,
    autoComplete: getAutoComplete('address-line1')
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "street2",
    autoComplete: getAutoComplete('address-line2')
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "postcode",
    required: true,
    autoComplete: getAutoComplete('postal-code')
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "city",
    required: true,
    autoComplete: getAutoComplete('address-level2')
  }), /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
    name: "country",
    placeholder: t('addressForm.countryFieldPlaceholder'),
    required: true,
    autoComplete: getAutoComplete('country')
  }, function (_ref) {
    var field = _ref.field,
        form = _ref.form;
    return /*#__PURE__*/_react.default.createElement(_falconShopData.CountryListQuery, {
      passLoading: true
    }, function (_ref2) {
      var _ref2$data$countryLis = _ref2.data.countryList,
          countryList = _ref2$data$countryLis === void 0 ? {
        items: []
      } : _ref2$data$countryLis;
      return /*#__PURE__*/_react.default.createElement(_Country.CountryPicker, (0, _extends2.default)({}, field, {
        options: countryList.items,
        onChange: function onChange(e) {
          form.setFieldValue(field.name, e);
          form.setFieldValue('region', null);
        }
      }));
    });
  }), selectedCountry && selectedCountry.id ? /*#__PURE__*/_react.default.createElement(_falconShopData.RegionListQuery, {
    passLoading: true,
    variables: {
      countryId: selectedCountry.id
    }
  }, function (_ref3) {
    var _ref3$data$regionList = _ref3.data.regionList,
        regionList = _ref3$data$regionList === void 0 ? {
      items: []
    } : _ref3$data$regionList,
        loading = _ref3.loading;

    if (!regionList.items.length && !loading) {
      return null;
    }

    if (loading) {
      return /*#__PURE__*/_react.default.createElement(_Loader.Loader, null);
    }

    return /*#__PURE__*/_react.default.createElement(_falconUi.Box, {
      position: "relative"
    }, /*#__PURE__*/_react.default.createElement(_Forms.FormField, {
      name: "region",
      required: true,
      placeholder: t('addressForm.regionFieldPlaceholder'),
      autoComplete: getAutoComplete('region')
    }, function (_ref4) {
      var field = _ref4.field,
          form = _ref4.form;
      return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, loading && /*#__PURE__*/_react.default.createElement(_Loader.Loader, {
        variant: "overlaySmall"
      }), /*#__PURE__*/_react.default.createElement(_Country.RegionPicker, (0, _extends2.default)({}, field, {
        options: regionList.items,
        onChange: function onChange(e) {
          form.setFieldValue(field.name, e);
        }
      })));
    }));
  }) : null));

  return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, askDefault && askDefaultFields, twoColumns ? /*#__PURE__*/_react.default.createElement(_Layouts.TwoColumnsLayout, null, mainContent) : mainContent);
};

exports.AddressFormFields = AddressFormFields;
AddressFormFields.defaultProps = {
  twoColumns: false,
  askDefault: false,
  askEmail: false
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BZGRyZXNzL0FkZHJlc3NGb3JtRmllbGRzLnRzeCJdLCJuYW1lcyI6WyJBZGRyZXNzRm9ybUZpZWxkcyIsInByb3BzIiwidHdvQ29sdW1ucyIsImFza0RlZmF1bHQiLCJhc2tFbWFpbCIsImF1dG9Db21wbGV0ZVNlY3Rpb24iLCJ0Iiwic2VsZWN0ZWRDb3VudHJ5IiwidmFsdWUiLCJnZXRBdXRvQ29tcGxldGUiLCJhdHRyaWJ1dGUiLCJmaWx0ZXIiLCJCb29sZWFuIiwiam9pbiIsImFza0RlZmF1bHRGaWVsZHMiLCJtYWluQ29udGVudCIsIlR3b0NvbHVtbnNMYXlvdXRBcmVhIiwibGVmdCIsInJpZ2h0IiwiZmllbGQiLCJmb3JtIiwiZGF0YSIsImNvdW50cnlMaXN0IiwiaXRlbXMiLCJlIiwic2V0RmllbGRWYWx1ZSIsIm5hbWUiLCJpZCIsImNvdW50cnlJZCIsInJlZ2lvbkxpc3QiLCJsb2FkaW5nIiwibGVuZ3RoIiwiZGVmYXVsdFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFZTyxJQUFNQSxpQkFBb0QsR0FBRyxTQUF2REEsaUJBQXVELENBQUFDLEtBQUssRUFBSTtBQUMzRSxNQUFRQyxVQUFSLEdBQWtFRCxLQUFsRSxDQUFRQyxVQUFSO0FBQUEsTUFBb0JDLFVBQXBCLEdBQWtFRixLQUFsRSxDQUFvQkUsVUFBcEI7QUFBQSxNQUFnQ0MsUUFBaEMsR0FBa0VILEtBQWxFLENBQWdDRyxRQUFoQztBQUFBLE1BQTBDQyxtQkFBMUMsR0FBa0VKLEtBQWxFLENBQTBDSSxtQkFBMUM7O0FBQ0EsaUJBQWMsMEJBQWQ7QUFBQSxNQUFRQyxDQUFSLFlBQVFBLENBQVI7O0FBQ0Esa0JBQXFDLHNCQUFjLFNBQWQsQ0FBckM7QUFBQSxNQUFnQkMsZUFBaEIsZ0JBQVNDLEtBQVQ7O0FBRUEsTUFBTUMsZUFBZSxHQUFHLFNBQWxCQSxlQUFrQixDQUFBQyxTQUFTO0FBQUEsV0FBSSxDQUFDTCxtQkFBRCxFQUFzQkssU0FBdEIsRUFBaUNDLE1BQWpDLENBQXdDQyxPQUF4QyxFQUFpREMsSUFBakQsQ0FBc0QsR0FBdEQsQ0FBSjtBQUFBLEdBQWpDOztBQUNBLE1BQU1DLGdCQUFnQixnQkFDcEIsNkJBQUMsYUFBRDtBQUFLLElBQUEsRUFBRSxFQUFDO0FBQVIsa0JBQ0UsNkJBQUMsd0JBQUQ7QUFBbUIsSUFBQSxJQUFJLEVBQUM7QUFBeEIsSUFERixlQUVFLDZCQUFDLHdCQUFEO0FBQW1CLElBQUEsSUFBSSxFQUFDO0FBQXhCLElBRkYsQ0FERixDQU4yRSxDQWEzRTs7O0FBQ0EsTUFBTUMsV0FBVyxnQkFDZix5RUFDRSw2QkFBQyxvQkFBRDtBQUFZLElBQUEsUUFBUSxFQUFFYixVQUFVLEdBQUdjLDhCQUFxQkMsSUFBeEIsR0FBK0I7QUFBL0QsS0FDR2IsUUFBUSxpQkFBSSw2QkFBQyxnQkFBRDtBQUFXLElBQUEsSUFBSSxFQUFDLE9BQWhCO0FBQXdCLElBQUEsSUFBSSxFQUFDLE9BQTdCO0FBQXFDLElBQUEsUUFBUTtBQUE3QyxJQURmLGVBRUUsNkJBQUMsZ0JBQUQ7QUFBVyxJQUFBLElBQUksRUFBQyxTQUFoQjtBQUEwQixJQUFBLFlBQVksRUFBRUssZUFBZSxDQUFDLFNBQUQ7QUFBdkQsSUFGRixlQUdFLDZCQUFDLGdCQUFEO0FBQVcsSUFBQSxJQUFJLEVBQUMsV0FBaEI7QUFBNEIsSUFBQSxRQUFRLE1BQXBDO0FBQXFDLElBQUEsWUFBWSxFQUFFQSxlQUFlLENBQUMsWUFBRDtBQUFsRSxJQUhGLGVBSUUsNkJBQUMsZ0JBQUQ7QUFBVyxJQUFBLElBQUksRUFBQyxVQUFoQjtBQUEyQixJQUFBLFFBQVEsTUFBbkM7QUFBb0MsSUFBQSxZQUFZLEVBQUVBLGVBQWUsQ0FBQyxhQUFEO0FBQWpFLElBSkYsZUFLRSw2QkFBQyxnQkFBRDtBQUFXLElBQUEsSUFBSSxFQUFDLFdBQWhCO0FBQTRCLElBQUEsUUFBUSxNQUFwQztBQUFxQyxJQUFBLFlBQVksRUFBRUEsZUFBZSxDQUFDLEtBQUQ7QUFBbEUsSUFMRixDQURGLGVBUUUsNkJBQUMsb0JBQUQ7QUFBWSxJQUFBLFFBQVEsRUFBRVAsVUFBVSxHQUFHYyw4QkFBcUJFLEtBQXhCLEdBQWdDO0FBQWhFLGtCQUNFLDZCQUFDLGdCQUFEO0FBQVcsSUFBQSxJQUFJLEVBQUMsU0FBaEI7QUFBMEIsSUFBQSxRQUFRLE1BQWxDO0FBQW1DLElBQUEsWUFBWSxFQUFFVCxlQUFlLENBQUMsZUFBRDtBQUFoRSxJQURGLGVBRUUsNkJBQUMsZ0JBQUQ7QUFBVyxJQUFBLElBQUksRUFBQyxTQUFoQjtBQUEwQixJQUFBLFlBQVksRUFBRUEsZUFBZSxDQUFDLGVBQUQ7QUFBdkQsSUFGRixlQUdFLDZCQUFDLGdCQUFEO0FBQVcsSUFBQSxJQUFJLEVBQUMsVUFBaEI7QUFBMkIsSUFBQSxRQUFRLE1BQW5DO0FBQW9DLElBQUEsWUFBWSxFQUFFQSxlQUFlLENBQUMsYUFBRDtBQUFqRSxJQUhGLGVBSUUsNkJBQUMsZ0JBQUQ7QUFBVyxJQUFBLElBQUksRUFBQyxNQUFoQjtBQUF1QixJQUFBLFFBQVEsTUFBL0I7QUFBZ0MsSUFBQSxZQUFZLEVBQUVBLGVBQWUsQ0FBQyxnQkFBRDtBQUE3RCxJQUpGLGVBS0UsNkJBQUMsZ0JBQUQ7QUFDRSxJQUFBLElBQUksRUFBQyxTQURQO0FBRUUsSUFBQSxXQUFXLEVBQUVILENBQUMsQ0FBQyxxQ0FBRCxDQUZoQjtBQUdFLElBQUEsUUFBUSxNQUhWO0FBSUUsSUFBQSxZQUFZLEVBQUVHLGVBQWUsQ0FBQyxTQUFEO0FBSi9CLEtBTUc7QUFBQSxRQUFHVSxLQUFILFFBQUdBLEtBQUg7QUFBQSxRQUFVQyxJQUFWLFFBQVVBLElBQVY7QUFBQSx3QkFDQyw2QkFBQyxnQ0FBRDtBQUFrQixNQUFBLFdBQVc7QUFBN0IsT0FDRztBQUFBLHdDQUFHQyxJQUFILENBQVdDLFdBQVg7QUFBQSxVQUFXQSxXQUFYLHNDQUF5QjtBQUFFQyxRQUFBQSxLQUFLLEVBQUU7QUFBVCxPQUF6QjtBQUFBLDBCQUNDLDZCQUFDLHNCQUFELDZCQUNNSixLQUROO0FBRUUsUUFBQSxPQUFPLEVBQUVHLFdBQVcsQ0FBQ0MsS0FGdkI7QUFHRSxRQUFBLFFBQVEsRUFBRSxrQkFBQUMsQ0FBQyxFQUFJO0FBQ2JKLFVBQUFBLElBQUksQ0FBQ0ssYUFBTCxDQUFtQk4sS0FBSyxDQUFDTyxJQUF6QixFQUErQkYsQ0FBL0I7QUFDQUosVUFBQUEsSUFBSSxDQUFDSyxhQUFMLENBQW1CLFFBQW5CLEVBQTZCLElBQTdCO0FBQ0Q7QUFOSCxTQUREO0FBQUEsS0FESCxDQUREO0FBQUEsR0FOSCxDQUxGLEVBMEJHbEIsZUFBZSxJQUFJQSxlQUFlLENBQUNvQixFQUFuQyxnQkFDQyw2QkFBQywrQkFBRDtBQUFpQixJQUFBLFdBQVcsTUFBNUI7QUFBNkIsSUFBQSxTQUFTLEVBQUU7QUFBRUMsTUFBQUEsU0FBUyxFQUFFckIsZUFBZSxDQUFDb0I7QUFBN0I7QUFBeEMsS0FDRyxpQkFBdUQ7QUFBQSxzQ0FBcEROLElBQW9ELENBQTVDUSxVQUE0QztBQUFBLFFBQTVDQSxVQUE0QyxzQ0FBL0I7QUFBRU4sTUFBQUEsS0FBSyxFQUFFO0FBQVQsS0FBK0I7QUFBQSxRQUFkTyxPQUFjLFNBQWRBLE9BQWM7O0FBQ3RELFFBQUksQ0FBQ0QsVUFBVSxDQUFDTixLQUFYLENBQWlCUSxNQUFsQixJQUE0QixDQUFDRCxPQUFqQyxFQUEwQztBQUN4QyxhQUFPLElBQVA7QUFDRDs7QUFFRCxRQUFJQSxPQUFKLEVBQWE7QUFDWCwwQkFBTyw2QkFBQyxjQUFELE9BQVA7QUFDRDs7QUFFRCx3QkFDRSw2QkFBQyxhQUFEO0FBQUssTUFBQSxRQUFRLEVBQUM7QUFBZCxvQkFDRSw2QkFBQyxnQkFBRDtBQUNFLE1BQUEsSUFBSSxFQUFDLFFBRFA7QUFFRSxNQUFBLFFBQVEsTUFGVjtBQUdFLE1BQUEsV0FBVyxFQUFFeEIsQ0FBQyxDQUFDLG9DQUFELENBSGhCO0FBSUUsTUFBQSxZQUFZLEVBQUVHLGVBQWUsQ0FBQyxRQUFEO0FBSi9CLE9BTUc7QUFBQSxVQUFHVSxLQUFILFNBQUdBLEtBQUg7QUFBQSxVQUFVQyxJQUFWLFNBQVVBLElBQVY7QUFBQSwwQkFDQyw0REFDR1UsT0FBTyxpQkFBSSw2QkFBQyxjQUFEO0FBQVEsUUFBQSxPQUFPLEVBQUM7QUFBaEIsUUFEZCxlQUVFLDZCQUFDLHFCQUFELDZCQUNNWCxLQUROO0FBRUUsUUFBQSxPQUFPLEVBQUVVLFVBQVUsQ0FBQ04sS0FGdEI7QUFHRSxRQUFBLFFBQVEsRUFBRSxrQkFBQUMsQ0FBQyxFQUFJO0FBQ2JKLFVBQUFBLElBQUksQ0FBQ0ssYUFBTCxDQUFtQk4sS0FBSyxDQUFDTyxJQUF6QixFQUErQkYsQ0FBL0I7QUFDRDtBQUxILFNBRkYsQ0FERDtBQUFBLEtBTkgsQ0FERixDQURGO0FBdUJELEdBakNILENBREQsR0FvQ0csSUE5RE4sQ0FSRixDQURGOztBQTRFQSxzQkFDRSw0REFDR3JCLFVBQVUsSUFBSVcsZ0JBRGpCLEVBRUdaLFVBQVUsZ0JBQUcsNkJBQUMseUJBQUQsUUFBbUJhLFdBQW5CLENBQUgsR0FBd0RBLFdBRnJFLENBREY7QUFNRCxDQWhHTTs7O0FBa0dQZixpQkFBaUIsQ0FBQ2dDLFlBQWxCLEdBQWlDO0FBQy9COUIsRUFBQUEsVUFBVSxFQUFFLEtBRG1CO0FBRS9CQyxFQUFBQSxVQUFVLEVBQUUsS0FGbUI7QUFHL0JDLEVBQUFBLFFBQVEsRUFBRTtBQUhxQixDQUFqQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB1c2VGaWVsZCB9IGZyb20gJ2Zvcm1payc7XG5pbXBvcnQgeyB1c2VJMThuIH0gZnJvbSAnQGRlaXR5L2ZhbGNvbi1pMThuJztcbmltcG9ydCB7IENvdW50cnlMaXN0UXVlcnksIFJlZ2lvbkxpc3RRdWVyeSB9IGZyb20gJ0BkZWl0eS9mYWxjb24tc2hvcC1kYXRhJztcbmltcG9ydCB7IEJveCwgR3JpZExheW91dCB9IGZyb20gJ0BkZWl0eS9mYWxjb24tdWknO1xuaW1wb3J0IHsgQ2hlY2tib3hGb3JtRmllbGQsIEZvcm1GaWVsZCB9IGZyb20gJy4uL0Zvcm1zJztcbmltcG9ydCB7IFR3b0NvbHVtbnNMYXlvdXRBcmVhLCBUd29Db2x1bW5zTGF5b3V0IH0gZnJvbSAnLi4vTGF5b3V0cyc7XG5pbXBvcnQgeyBDb3VudHJ5UGlja2VyLCBSZWdpb25QaWNrZXIgfSBmcm9tICcuLi9Db3VudHJ5JztcbmltcG9ydCB7IExvYWRlciB9IGZyb20gJy4uL0xvYWRlcic7XG5cbmV4cG9ydCB0eXBlIEFkZHJlc3NGb3JtRmllbGRzUHJvcHMgPSB7XG4gIGF1dG9Db21wbGV0ZVNlY3Rpb24/OiBzdHJpbmc7XG4gIC8vIHdoZXRoZXIgdG8gdXNlIGEgdHdvIGNvbHVtbiBsYXlvdXQgaW5zdGVhZCBvZiBhIHNpbmdsZSBjb2x1bW5cbiAgdHdvQ29sdW1ucz86IGJvb2xlYW47XG4gIC8vIHdoZXRoZXIgdGhlIGZvcm0gc2hvdWxkIGFzayB3aGV0aGVyIHRoZSBhZGRyZXNzIHNob3VsZCBiZSBzZXQgYXMgZGVmYXVsdFxuICBhc2tEZWZhdWx0PzogYm9vbGVhbjtcbiAgLy8gd2hldGhlciB0aGUgZm9ybSBzaG91bGQgYXNrIGZvciBhbiBlbWFpbCBhZGRyZXNzXG4gIGFza0VtYWlsPzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCBjb25zdCBBZGRyZXNzRm9ybUZpZWxkczogUmVhY3QuU0ZDPEFkZHJlc3NGb3JtRmllbGRzUHJvcHM+ID0gcHJvcHMgPT4ge1xuICBjb25zdCB7IHR3b0NvbHVtbnMsIGFza0RlZmF1bHQsIGFza0VtYWlsLCBhdXRvQ29tcGxldGVTZWN0aW9uIH0gPSBwcm9wcztcbiAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gIGNvbnN0IFt7IHZhbHVlOiBzZWxlY3RlZENvdW50cnkgfV0gPSB1c2VGaWVsZDxhbnk+KCdjb3VudHJ5Jyk7XG5cbiAgY29uc3QgZ2V0QXV0b0NvbXBsZXRlID0gYXR0cmlidXRlID0+IFthdXRvQ29tcGxldGVTZWN0aW9uLCBhdHRyaWJ1dGVdLmZpbHRlcihCb29sZWFuKS5qb2luKCcgJyk7XG4gIGNvbnN0IGFza0RlZmF1bHRGaWVsZHMgPSAoXG4gICAgPEJveCBtYj1cInNtXCI+XG4gICAgICA8Q2hlY2tib3hGb3JtRmllbGQgbmFtZT1cImRlZmF1bHRTaGlwcGluZ1wiIC8+XG4gICAgICA8Q2hlY2tib3hGb3JtRmllbGQgbmFtZT1cImRlZmF1bHRCaWxsaW5nXCIgLz5cbiAgICA8L0JveD5cbiAgKTtcblxuICAvLyB0aGUgZm9ybSBjb250ZW50LCBub3QgaW5jbHVkaW5nIGRlZmF1bHQgYWRkcmVzcyBmaWVsZHMgYW5kIHN1Ym1pdCBidXR0b24ocylcbiAgY29uc3QgbWFpbkNvbnRlbnQgPSAoXG4gICAgPD5cbiAgICAgIDxHcmlkTGF5b3V0IGdyaWRBcmVhPXt0d29Db2x1bW5zID8gVHdvQ29sdW1uc0xheW91dEFyZWEubGVmdCA6IG51bGx9PlxuICAgICAgICB7YXNrRW1haWwgJiYgPEZvcm1GaWVsZCBuYW1lPVwiZW1haWxcIiB0eXBlPVwiZW1haWxcIiByZXF1aXJlZCAvPn1cbiAgICAgICAgPEZvcm1GaWVsZCBuYW1lPVwiY29tcGFueVwiIGF1dG9Db21wbGV0ZT17Z2V0QXV0b0NvbXBsZXRlKCdjb21wYW55Jyl9IC8+XG4gICAgICAgIDxGb3JtRmllbGQgbmFtZT1cImZpcnN0bmFtZVwiIHJlcXVpcmVkIGF1dG9Db21wbGV0ZT17Z2V0QXV0b0NvbXBsZXRlKCdnaXZlbi1uYW1lJyl9IC8+XG4gICAgICAgIDxGb3JtRmllbGQgbmFtZT1cImxhc3RuYW1lXCIgcmVxdWlyZWQgYXV0b0NvbXBsZXRlPXtnZXRBdXRvQ29tcGxldGUoJ2ZhbWlseS1uYW1lJyl9IC8+XG4gICAgICAgIDxGb3JtRmllbGQgbmFtZT1cInRlbGVwaG9uZVwiIHJlcXVpcmVkIGF1dG9Db21wbGV0ZT17Z2V0QXV0b0NvbXBsZXRlKCd0ZWwnKX0gLz5cbiAgICAgIDwvR3JpZExheW91dD5cbiAgICAgIDxHcmlkTGF5b3V0IGdyaWRBcmVhPXt0d29Db2x1bW5zID8gVHdvQ29sdW1uc0xheW91dEFyZWEucmlnaHQgOiBudWxsfT5cbiAgICAgICAgPEZvcm1GaWVsZCBuYW1lPVwic3RyZWV0MVwiIHJlcXVpcmVkIGF1dG9Db21wbGV0ZT17Z2V0QXV0b0NvbXBsZXRlKCdhZGRyZXNzLWxpbmUxJyl9IC8+XG4gICAgICAgIDxGb3JtRmllbGQgbmFtZT1cInN0cmVldDJcIiBhdXRvQ29tcGxldGU9e2dldEF1dG9Db21wbGV0ZSgnYWRkcmVzcy1saW5lMicpfSAvPlxuICAgICAgICA8Rm9ybUZpZWxkIG5hbWU9XCJwb3N0Y29kZVwiIHJlcXVpcmVkIGF1dG9Db21wbGV0ZT17Z2V0QXV0b0NvbXBsZXRlKCdwb3N0YWwtY29kZScpfSAvPlxuICAgICAgICA8Rm9ybUZpZWxkIG5hbWU9XCJjaXR5XCIgcmVxdWlyZWQgYXV0b0NvbXBsZXRlPXtnZXRBdXRvQ29tcGxldGUoJ2FkZHJlc3MtbGV2ZWwyJyl9IC8+XG4gICAgICAgIDxGb3JtRmllbGRcbiAgICAgICAgICBuYW1lPVwiY291bnRyeVwiXG4gICAgICAgICAgcGxhY2Vob2xkZXI9e3QoJ2FkZHJlc3NGb3JtLmNvdW50cnlGaWVsZFBsYWNlaG9sZGVyJyl9XG4gICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICBhdXRvQ29tcGxldGU9e2dldEF1dG9Db21wbGV0ZSgnY291bnRyeScpfVxuICAgICAgICA+XG4gICAgICAgICAgeyh7IGZpZWxkLCBmb3JtIH0pID0+IChcbiAgICAgICAgICAgIDxDb3VudHJ5TGlzdFF1ZXJ5IHBhc3NMb2FkaW5nPlxuICAgICAgICAgICAgICB7KHsgZGF0YTogeyBjb3VudHJ5TGlzdCA9IHsgaXRlbXM6IFtdIH0gfSB9KSA9PiAoXG4gICAgICAgICAgICAgICAgPENvdW50cnlQaWNrZXJcbiAgICAgICAgICAgICAgICAgIHsuLi5maWVsZH1cbiAgICAgICAgICAgICAgICAgIG9wdGlvbnM9e2NvdW50cnlMaXN0Lml0ZW1zfVxuICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3JtLnNldEZpZWxkVmFsdWUoZmllbGQubmFtZSwgZSk7XG4gICAgICAgICAgICAgICAgICAgIGZvcm0uc2V0RmllbGRWYWx1ZSgncmVnaW9uJywgbnVsbCk7XG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8L0NvdW50cnlMaXN0UXVlcnk+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9Gb3JtRmllbGQ+XG4gICAgICAgIHtzZWxlY3RlZENvdW50cnkgJiYgc2VsZWN0ZWRDb3VudHJ5LmlkID8gKFxuICAgICAgICAgIDxSZWdpb25MaXN0UXVlcnkgcGFzc0xvYWRpbmcgdmFyaWFibGVzPXt7IGNvdW50cnlJZDogc2VsZWN0ZWRDb3VudHJ5LmlkIH19PlxuICAgICAgICAgICAgeyh7IGRhdGE6IHsgcmVnaW9uTGlzdCA9IHsgaXRlbXM6IFtdIH0gfSwgbG9hZGluZyB9KSA9PiB7XG4gICAgICAgICAgICAgIGlmICghcmVnaW9uTGlzdC5pdGVtcy5sZW5ndGggJiYgIWxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDxMb2FkZXIgLz47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxCb3ggcG9zaXRpb249XCJyZWxhdGl2ZVwiPlxuICAgICAgICAgICAgICAgICAgPEZvcm1GaWVsZFxuICAgICAgICAgICAgICAgICAgICBuYW1lPVwicmVnaW9uXCJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e3QoJ2FkZHJlc3NGb3JtLnJlZ2lvbkZpZWxkUGxhY2Vob2xkZXInKX1cbiAgICAgICAgICAgICAgICAgICAgYXV0b0NvbXBsZXRlPXtnZXRBdXRvQ29tcGxldGUoJ3JlZ2lvbicpfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7KHsgZmllbGQsIGZvcm0gfSkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgICAgICAgICB7bG9hZGluZyAmJiA8TG9hZGVyIHZhcmlhbnQ9XCJvdmVybGF5U21hbGxcIiAvPn1cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSZWdpb25QaWNrZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgey4uLmZpZWxkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zPXtyZWdpb25MaXN0Lml0ZW1zfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zZXRGaWVsZFZhbHVlKGZpZWxkLm5hbWUsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICA8Lz5cbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgIDwvRm9ybUZpZWxkPlxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICA8L1JlZ2lvbkxpc3RRdWVyeT5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L0dyaWRMYXlvdXQ+XG4gICAgPC8+XG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAge2Fza0RlZmF1bHQgJiYgYXNrRGVmYXVsdEZpZWxkc31cbiAgICAgIHt0d29Db2x1bW5zID8gPFR3b0NvbHVtbnNMYXlvdXQ+e21haW5Db250ZW50fTwvVHdvQ29sdW1uc0xheW91dD4gOiBtYWluQ29udGVudH1cbiAgICA8Lz5cbiAgKTtcbn07XG5cbkFkZHJlc3NGb3JtRmllbGRzLmRlZmF1bHRQcm9wcyA9IHtcbiAgdHdvQ29sdW1uczogZmFsc2UsXG4gIGFza0RlZmF1bHQ6IGZhbHNlLFxuICBhc2tFbWFpbDogZmFsc2Vcbn07XG4iXX0=