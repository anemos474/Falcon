"use strict";

var _interopRequireWildcard = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireWildcard");

exports.__esModule = true;
exports.ProductGallery = void 0;

var _react = /*#__PURE__*/_interopRequireWildcard( /*#__PURE__*/require("react"));

var _falconUi = /*#__PURE__*/require("@deity/falcon-ui");

var _falconI18n = /*#__PURE__*/require("@deity/falcon-i18n");

var _helpers = /*#__PURE__*/require("../helpers");

var _ProductGalleryLayout = /*#__PURE__*/require("./ProductGalleryLayout");

var _NoProductImagePlaceholder = /*#__PURE__*/require("./NoProductImagePlaceholder");

var _ProductGalleryThumbLayout = /*#__PURE__*/require("./ProductGalleryThumbLayout");

var ProductGallery = function ProductGallery(_ref) {
  var items = _ref.items;
  var scrollableElement = (0, _react.useRef)(null);

  var _useState = (0, _react.useState)(0),
      activeElementIndex = _useState[0],
      setActiveElementIndex = _useState[1];

  var _useI18n = (0, _falconI18n.useI18n)(),
      t = _useI18n.t;

  var scrollToItem = function scrollToItem(elementIndex) {
    var container = scrollableElement.current;

    if (container) {
      container.scrollTo({
        left: elementIndex * container.clientWidth,
        behavior: 'smooth'
      });
    }
  };

  var handleScroll = function handleScroll(event) {
    var container = event.target; // needed because event will be nullified after callback

    if (container) {
      window.requestAnimationFrame(function () {
        // Find the item that has the largest visible portion
        var newIndex = Math.floor(items.length * container.scrollLeft / container.scrollWidth + 0.5);
        setActiveElementIndex(newIndex);
      });
    }
  };

  (0, _react.useEffect)(function () {
    // set Default Image to be active
    var defaultItemIndex = items.findIndex(function (item) {
      return item.isDefault;
    });

    if (defaultItemIndex !== -1) {
      scrollToItem(defaultItemIndex);
    }
  }, [items]);

  if (!items.length) {
    return /*#__PURE__*/_react.default.createElement(_NoProductImagePlaceholder.NoProductImagePlaceholder, null);
  }

  if (items.length === 1) {
    return /*#__PURE__*/_react.default.createElement(_falconUi.Image, {
      src: items[0].full,
      alt: t('productGallery.imageAlt')
    });
  }

  return /*#__PURE__*/_react.default.createElement(_ProductGalleryLayout.ProductGalleryLayout, null, /*#__PURE__*/_react.default.createElement(_falconUi.Box, {
    gridArea: _ProductGalleryLayout.productGalleryLayoutArea.thumbs
  }, items.map(function (item, index) {
    if (item.thumbnail) {
      return /*#__PURE__*/_react.default.createElement(_ProductGalleryThumbLayout.ProductGalleryThumbLayout, {
        onClick: function onClick() {
          return scrollToItem(index);
        },
        "aria-label": t('productGallery.showImageOf', {
          index: index + 1,
          total: items.length
        }),
        variant: index === activeElementIndex && 'selected',
        key: item.full
      }, /*#__PURE__*/_react.default.createElement(_falconUi.Image, {
        key: item.thumbnail,
        src: item.thumbnail,
        alt: t('productGallery.imageAlt')
      }));
    }

    return null;
  })), /*#__PURE__*/_react.default.createElement(_falconUi.Swipeable, {
    gridArea: _ProductGalleryLayout.productGalleryLayoutArea.full,
    ref: scrollableElement,
    onScroll: handleScroll,
    alignItems: "center",
    css: (0, _helpers.noScrollbars)()
  }, items.map(function (item) {
    return /*#__PURE__*/_react.default.createElement(_falconUi.SwipeableItem, {
      key: item.thumbnail,
      as: _falconUi.Image,
      src: item.full,
      alt: t('productGallery.imageAlt')
    });
  })));
};

exports.ProductGallery = ProductGallery;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Qcm9kdWN0L1Byb2R1Y3RHYWxsZXJ5LnRzeCJdLCJuYW1lcyI6WyJQcm9kdWN0R2FsbGVyeSIsIml0ZW1zIiwic2Nyb2xsYWJsZUVsZW1lbnQiLCJhY3RpdmVFbGVtZW50SW5kZXgiLCJzZXRBY3RpdmVFbGVtZW50SW5kZXgiLCJ0Iiwic2Nyb2xsVG9JdGVtIiwiZWxlbWVudEluZGV4IiwiY29udGFpbmVyIiwiY3VycmVudCIsInNjcm9sbFRvIiwibGVmdCIsImNsaWVudFdpZHRoIiwiYmVoYXZpb3IiLCJoYW5kbGVTY3JvbGwiLCJldmVudCIsInRhcmdldCIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm5ld0luZGV4IiwiTWF0aCIsImZsb29yIiwibGVuZ3RoIiwic2Nyb2xsTGVmdCIsInNjcm9sbFdpZHRoIiwiZGVmYXVsdEl0ZW1JbmRleCIsImZpbmRJbmRleCIsIml0ZW0iLCJpc0RlZmF1bHQiLCJmdWxsIiwicHJvZHVjdEdhbGxlcnlMYXlvdXRBcmVhIiwidGh1bWJzIiwibWFwIiwiaW5kZXgiLCJ0aHVtYm5haWwiLCJ0b3RhbCIsIkltYWdlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBVU8sSUFBTUEsY0FBNkMsR0FBRyxTQUFoREEsY0FBZ0QsT0FBZTtBQUFBLE1BQVpDLEtBQVksUUFBWkEsS0FBWTtBQUMxRSxNQUFNQyxpQkFBaUIsR0FBRyxtQkFBTyxJQUFQLENBQTFCOztBQUNBLGtCQUFvRCxxQkFBUyxDQUFULENBQXBEO0FBQUEsTUFBT0Msa0JBQVA7QUFBQSxNQUEyQkMscUJBQTNCOztBQUNBLGlCQUFjLDBCQUFkO0FBQUEsTUFBUUMsQ0FBUixZQUFRQSxDQUFSOztBQUVBLE1BQU1DLFlBQVksR0FBRyxTQUFmQSxZQUFlLENBQUNDLFlBQUQsRUFBMEI7QUFDN0MsUUFBTUMsU0FBUyxHQUFHTixpQkFBaUIsQ0FBQ08sT0FBcEM7O0FB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QyxRQUpiO0FBS0UsSUFBQSxHQUFHLEVBQUU7QUFMUCxLQU9HYixLQUFLLENBQUMrQixHQUFOLENBQVUsVUFBQUwsSUFBSTtBQUFBLHdCQUNiLDZCQUFDLHVCQUFEO0FBQWUsTUFBQSxHQUFHLEVBQUVBLElBQUksQ0FBQ08sU0FBekI7QUFBb0MsTUFBQSxFQUFFLEVBQUVFLGVBQXhDO0FBQStDLE1BQUEsR0FBRyxFQUFFVCxJQUFJLENBQUNFLElBQXpEO0FBQStELE1BQUEsR0FBRyxFQUFFeEIsQ0FBQyxDQUFDLHlCQUFEO0FBQXJFLE1BRGE7QUFBQSxHQUFkLENBUEgsQ0FuQkYsQ0FERjtBQWlDRCxDQTdFTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBVSUV2ZW50LCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBCb3gsIEltYWdlLCBTd2lwZWFibGUsIFN3aXBlYWJsZUl0ZW0gfSBmcm9tICdAZGVpdHkvZmFsY29uLXVpJztcbmltcG9ydCB7IHVzZUkxOG4gfSBmcm9tICdAZGVpdHkvZmFsY29uLWkxOG4nO1xuaW1wb3J0IHsgbm9TY3JvbGxiYXJzIH0gZnJvbSAnLi4vaGVscGVycyc7XG5pbXBvcnQgeyBQcm9kdWN0R2FsbGVyeUxheW91dCwgcHJvZHVjdEdhbGxlcnlMYXlvdXRBcmVhIH0gZnJvbSAnLi9Qcm9kdWN0R2FsbGVyeUxheW91dCc7XG5pbXBvcnQgeyBOb1Byb2R1Y3RJbWFnZVBsYWNlaG9sZGVyIH0gZnJvbSAnLi9Ob1Byb2R1Y3RJbWFnZVBsYWNlaG9sZGVyJztcbmltcG9ydCB7IFByb2R1Y3RHYWxsZXJ5VGh1bWJMYXlvdXQgfSBmcm9tICcuL1Byb2R1Y3RHYWxsZXJ5VGh1bWJMYXlvdXQnO1xuXG5leHBvcnQgdHlwZSBHYWxsZXJ5SXRlbSA9IHtcbiAgZnVsbDogc3RyaW5nO1xuICB0aHVtYm5haWw6IHN0cmluZztcbiAgaXNEZWZhdWx0OiBib29sZWFuO1xufTtcbmV4cG9ydCB0eXBlIFByb2R1Y3RHYWxsZXJ5UHJvcHMgPSB7XG4gIGl0ZW1zOiBHYWxsZXJ5SXRlbVtdO1xufTtcbmV4cG9ydCBjb25zdCBQcm9kdWN0R2FsbGVyeTogUmVhY3QuRkM8UHJvZHVjdEdhbGxlcnlQcm9wcz4gPSAoeyBpdGVtcyB9KSA9PiB7XG4gIGNvbnN0IHNjcm9sbGFibGVFbGVtZW50ID0gdXNlUmVmKG51bGwpO1xuICBjb25zdCBbYWN0aXZlRWxlbWVudEluZGV4LCBzZXRBY3RpdmVFbGVtZW50SW5kZXhdID0gdXNlU3RhdGUoMCk7XG4gIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuXG4gIGNvbnN0IHNjcm9sbFRvSXRlbSA9IChlbGVtZW50SW5kZXg6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IHNjcm9sbGFibGVFbGVtZW50LmN1cnJlbnQ7XG5cbiAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICBjb250YWluZXIuc2Nyb2xsVG8oe1xuICAgICAgICBsZWZ0OiBlbGVtZW50SW5kZXggKiBjb250YWluZXIuY2xpZW50V2lkdGgsXG4gICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJ1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGhhbmRsZVNjcm9sbCA9IChldmVudDogVUlFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBldmVudC50YXJnZXQgYXMgRWxlbWVudCB8IG51bGw7IC8vIG5lZWRlZCBiZWNhdXNlIGV2ZW50IHdpbGwgYmUgbnVsbGlmaWVkIGFmdGVyIGNhbGxiYWNrXG5cbiAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgLy8gRmluZCB0aGUgaXRlbSB0aGF0IGhhcyB0aGUgbGFyZ2VzdCB2aXNpYmxlIHBvcnRpb25cbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSBNYXRoLmZsb29yKChpdGVtcy5sZW5ndGggKiBjb250YWluZXIuc2Nyb2xsTGVmdCkgLyBjb250YWluZXIuc2Nyb2xsV2lkdGggKyAwLjUpO1xuICAgICAgICBzZXRBY3RpdmVFbGVtZW50SW5kZXgobmV3SW5kZXgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gc2V0IERlZmF1bHQgSW1hZ2UgdG8gYmUgYWN0aXZlXG4gICAgY29uc3QgZGVmYXVsdEl0ZW1JbmRleCA9IGl0ZW1zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaXNEZWZhdWx0KTtcbiAgICBpZiAoZGVmYXVsdEl0ZW1JbmRleCAhPT0gLTEpIHtcbiAgICAgIHNjcm9sbFRvSXRlbShkZWZhdWx0SXRlbUluZGV4KTtcbiAgICB9XG4gIH0sIFtpdGVtc10pO1xuXG4gIGlmICghaXRlbXMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIDxOb1Byb2R1Y3RJbWFnZVBsYWNlaG9sZGVyIC8+O1xuICB9XG5cbiAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMSkge1xuICAgIHJldHVybiA8SW1hZ2Ugc3JjPXtpdGVtc1swXS5mdWxsfSBhbHQ9e3QoJ3Byb2R1Y3RHYWxsZXJ5LmltYWdlQWx0Jyl9IC8+O1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8UHJvZHVjdEdhbGxlcnlMYXlvdXQ+XG4gICAgICA8Qm94IGdyaWRBcmVhPXtwcm9kdWN0R2FsbGVyeUxheW91dEFyZWEudGh1bWJzfT5cbiAgICAgICAge2l0ZW1zLm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgICBpZiAoaXRlbS50aHVtYm5haWwpIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIDxQcm9kdWN0R2FsbGVyeVRodW1iTGF5b3V0XG4gICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2Nyb2xsVG9JdGVtKGluZGV4KX1cbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXt0KCdwcm9kdWN0R2FsbGVyeS5zaG93SW1hZ2VPZicsIHsgaW5kZXg6IGluZGV4ICsgMSwgdG90YWw6IGl0ZW1zLmxlbmd0aCB9KX1cbiAgICAgICAgICAgICAgICB2YXJpYW50PXtpbmRleCA9PT0gYWN0aXZlRWxlbWVudEluZGV4ICYmICdzZWxlY3RlZCd9XG4gICAgICAgICAgICAgICAga2V5PXtpdGVtLmZ1bGx9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8SW1hZ2Uga2V5PXtpdGVtLnRodW1ibmFpbH0gc3JjPXtpdGVtLnRodW1ibmFpbH0gYWx0PXt0KCdwcm9kdWN0R2FsbGVyeS5pbWFnZUFsdCcpfSAvPlxuICAgICAgICAgICAgICA8L1Byb2R1Y3RHYWxsZXJ5VGh1bWJMYXlvdXQ+XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSl9XG4gICAgICA8L0JveD5cblxuICAgICAgPFN3aXBlYWJsZVxuICAgICAgICBncmlkQXJlYT17cHJvZHVjdEdhbGxlcnlMYXlvdXRBcmVhLmZ1bGx9XG4gICAgICAgIHJlZj17c2Nyb2xsYWJsZUVsZW1lbnR9XG4gICAgICAgIG9uU2Nyb2xsPXtoYW5kbGVTY3JvbGx9XG4gICAgICAgIGFsaWduSXRlbXM9XCJjZW50ZXJcIlxuICAgICAgICBjc3M9e25vU2Nyb2xsYmFycygpfVxuICAgICAgPlxuICAgICAgICB7aXRlbXMubWFwKGl0ZW0gPT4gKFxuICAgICAgICAgIDxTd2lwZWFibGVJdGVtIGtleT17aXRlbS50aHVtYm5haWx9IGFzPXtJbWFnZX0gc3JjPXtpdGVtLmZ1bGx9IGFsdD17dCgncHJvZHVjdEdhbGxlcnkuaW1hZ2VBbHQnKX0gLz5cbiAgICAgICAgKSl9XG4gICAgICA8L1N3aXBlYWJsZT5cbiAgICA8L1Byb2R1Y3RHYWxsZXJ5TGF5b3V0PlxuICApO1xufTtcbiJdfQ==