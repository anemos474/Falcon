import { setContext } from '@apollo/client/link/context';

const FALCON_SCOPE_ID_HEADER_NAME = 'falcon-scope-id';

/**
 * Falcon Scope Id provider
 * @callback FalconScopeIdProvider
 * @returns {string} scope id
 */

/**
 * Apollo link which sets Falcon Scope ID in headers
 * @param {FalconScopeIdProvider} scopeIdProvider invoked per each request
 */
export const getFalconScopeIdLink = scopeIdProvider => {
  return setContext((_, { headers = {}, ...rest }) => {
    const scopeId = scopeIdProvider();

    return {
      ...rest,
      headers: {
        ...headers,
        ...(scopeId ? { [FALCON_SCOPE_ID_HEADER_NAME]: scopeId } : {})
      }
    };
  });
};
