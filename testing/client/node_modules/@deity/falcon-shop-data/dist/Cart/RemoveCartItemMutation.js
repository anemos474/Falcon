"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.RemoveCartItemMutation = exports.REMOVE_CART_ITEM = void 0;

var _inheritsLoose2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/inheritsLoose"));

var _falconData = /*#__PURE__*/require("@deity/falcon-data");

var _CartQuery = /*#__PURE__*/require("./CartQuery");

var REMOVE_CART_ITEM = {
  "kind": "Document",
  "definitions": [{
    "kind": "OperationDefinition",
    "operation": "mutation",
    "name": {
      "kind": "Name",
      "value": "RemoveCartItem"
    },
    "variableDefinitions": [{
      "kind": "VariableDefinition",
      "variable": {
        "kind": "Variable",
        "name": {
          "kind": "Name",
          "value": "input"
        }
      },
      "type": {
        "kind": "NonNullType",
        "type": {
          "kind": "NamedType",
          "name": {
            "kind": "Name",
            "value": "RemoveCartItemInput"
          }
        }
      },
      "directives": []
    }],
    "directives": [],
    "selectionSet": {
      "kind": "SelectionSet",
      "selections": [{
        "kind": "Field",
        "name": {
          "kind": "Name",
          "value": "removeCartItem"
        },
        "arguments": [{
          "kind": "Argument",
          "name": {
            "kind": "Name",
            "value": "input"
          },
          "value": {
            "kind": "Variable",
            "name": {
              "kind": "Name",
              "value": "input"
            }
          }
        }],
        "directives": [],
        "selectionSet": {
          "kind": "SelectionSet",
          "selections": [{
            "kind": "Field",
            "name": {
              "kind": "Name",
              "value": "id"
            },
            "arguments": [],
            "directives": []
          }]
        }
      }]
    }
  }],
  "loc": {
    "start": 0,
    "end": 114,
    "source": {
      "body": "\n  mutation RemoveCartItem($input: RemoveCartItemInput!) {\n    removeCartItem(input: $input) {\n      id\n    }\n  }\n",
      "name": "GraphQL request",
      "locationOffset": {
        "line": 1,
        "column": 1
      }
    }
  }
};
exports.REMOVE_CART_ITEM = REMOVE_CART_ITEM;

var RemoveCartItemMutation = /*#__PURE__*/function (_Mutation) {
  (0, _inheritsLoose2.default)(RemoveCartItemMutation, _Mutation);

  function RemoveCartItemMutation() {
    return _Mutation.apply(this, arguments) || this;
  }

  return RemoveCartItemMutation;
}(_falconData.Mutation);

exports.RemoveCartItemMutation = RemoveCartItemMutation;
RemoveCartItemMutation.defaultProps = {
  mutation: REMOVE_CART_ITEM,
  refetchQueries: ['Cart', 'MiniCart', 'CheckoutState'],
  awaitRefetchQueries: true,
  update: function update(store, _ref) {
    var removeCartItem = _ref.data.removeCartItem;
    var data = store.readQuery({
      query: _CartQuery.GET_CART
    });
    var updatedCart = {};

    if (removeCartItem) {
      var id = removeCartItem.id;
      updatedCart['items'] = data.cart.items.filter(function (item) {
        return item.id !== id;
      });
      updatedCart['itemsQty'] = data.cart.items.length;
    } else {
      // Something isn't right.. clear the entire cart.
      // `removeCartItem` can be `null` if the user adds something to their cart and then logs out
      updatedCart['items'] = [];
      updatedCart['itemsQty'] = data.cart.items.length;
    }

    store.writeQuery({
      query: _CartQuery.GET_CART,
      data: Object.assign({}, data, {
        cart: Object.assign({}, data.cart, updatedCart)
      })
    });
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DYXJ0L1JlbW92ZUNhcnRJdGVtTXV0YXRpb24udHN4Il0sIm5hbWVzIjpbIlJFTU9WRV9DQVJUX0lURU0iLCJSZW1vdmVDYXJ0SXRlbU11dGF0aW9uIiwiTXV0YXRpb24iLCJkZWZhdWx0UHJvcHMiLCJtdXRhdGlvbiIsInJlZmV0Y2hRdWVyaWVzIiwiYXdhaXRSZWZldGNoUXVlcmllcyIsInVwZGF0ZSIsInN0b3JlIiwicmVtb3ZlQ2FydEl0ZW0iLCJkYXRhIiwicmVhZFF1ZXJ5IiwicXVlcnkiLCJHRVRfQ0FSVCIsInVwZGF0ZWRDYXJ0IiwiaWQiLCJjYXJ0IiwiaXRlbXMiLCJmaWx0ZXIiLCJpdGVtIiwibGVuZ3RoIiwid3JpdGVRdWVyeSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ0E7O0FBRUE7O0FBRU8sSUFBTUEsZ0JBQWdCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLENBQXRCOzs7SUFZTUMsc0I7Ozs7Ozs7O0VBQStCQyxvQjs7O0FBQS9CRCxzQixDQUNKRSxZLEdBQWU7QUFDcEJDLEVBQUFBLFFBQVEsRUFBRUosZ0JBRFU7QUFFcEJLLEVBQUFBLGNBQWMsRUFBRSxDQUFDLE1BQUQsRUFBUyxVQUFULEVBQXFCLGVBQXJCLENBRkk7QUFHcEJDLEVBQUFBLG1CQUFtQixFQUFFLElBSEQ7QUFJcEJDLEVBQUFBLE1BQU0sRUFBRSxnQkFBQ0MsS0FBRCxRQUFtRDtBQUFBLFFBQTVCQyxjQUE0QixRQUFwQ0MsSUFBb0MsQ0FBNUJELGNBQTRCO0FBQ3pELFFBQU1DLElBQUksR0FBR0YsS0FBSyxDQUFDRyxTQUFOLENBQWdCO0FBQzNCQyxNQUFBQSxLQUFLLEVBQUVDO0FBRG9CLEtBQWhCLENBQWI7QUFJQSxRQUFNQyxXQUFXLEdBQUcsRUFBcEI7O0FBRUEsUUFBSUwsY0FBSixFQUFvQjtBQUNsQixVQUFRTSxFQUFSLEdBQWVOLGNBQWYsQ0FBUU0sRUFBUjtBQUVBRCxNQUFBQSxXQUFXLENBQUMsT0FBRCxDQUFYLEdBQXVCSixJQUFJLENBQUNNLElBQUwsQ0FBVUMsS0FBVixDQUFnQkMsTUFBaEIsQ0FBdUIsVUFBQ0MsSUFBRDtBQUFBLGVBQWVBLElBQUksQ0FBQ0osRUFBTCxLQUFZQSxFQUEzQjtBQUFBLE9BQXZCLENBQXZCO0FBQ0FELE1BQUFBLFdBQVcsQ0FBQyxVQUFELENBQVgsR0FBMEJKLElBQUksQ0FBQ00sSUFBTCxDQUFVQyxLQUFWLENBQWdCRyxNQUExQztBQUNELEtBTEQsTUFLTztBQUNMO0FBQ0E7QUFDQU4sTUFBQUEsV0FBVyxDQUFDLE9BQUQsQ0FBWCxHQUF1QixFQUF2QjtBQUNBQSxNQUFBQSxXQUFXLENBQUMsVUFBRCxDQUFYLEdBQTBCSixJQUFJLENBQUNNLElBQUwsQ0FBVUMsS0FBVixDQUFnQkcsTUFBMUM7QUFDRDs7QUFFRFosSUFBQUEsS0FBSyxDQUFDYSxVQUFOLENBQWlCO0FBQ2ZULE1BQUFBLEtBQUssRUFBRUMsbUJBRFE7QUFFZkgsTUFBQUEsSUFBSSxvQkFDQ0EsSUFERDtBQUVGTSxRQUFBQSxJQUFJLG9CQUNDTixJQUFJLENBQUNNLElBRE4sRUFFQ0YsV0FGRDtBQUZGO0FBRlcsS0FBakI7QUFVRDtBQWpDbUIsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdxbCB9IGZyb20gJ0BhcG9sbG8vY2xpZW50JztcbmltcG9ydCB7IE11dGF0aW9uLCBPcGVyYXRpb25JbnB1dCB9IGZyb20gJ0BkZWl0eS9mYWxjb24tZGF0YSc7XG5pbXBvcnQgeyBSZW1vdmVDYXJ0SXRlbUlucHV0LCBSZW1vdmVDYXJ0SXRlbVBheWxvYWQgfSBmcm9tICdAZGVpdHkvZmFsY29uLXNob3AtZXh0ZW5zaW9uJztcbmltcG9ydCB7IEdFVF9DQVJUIH0gZnJvbSAnLi9DYXJ0UXVlcnknO1xuXG5leHBvcnQgY29uc3QgUkVNT1ZFX0NBUlRfSVRFTSA9IGdxbGBcbiAgbXV0YXRpb24gUmVtb3ZlQ2FydEl0ZW0oJGlucHV0OiBSZW1vdmVDYXJ0SXRlbUlucHV0ISkge1xuICAgIHJlbW92ZUNhcnRJdGVtKGlucHV0OiAkaW5wdXQpIHtcbiAgICAgIGlkXG4gICAgfVxuICB9XG5gO1xuXG5leHBvcnQgdHlwZSBSZW1vdmVDYXJ0SXRlbVJlc3BvbnNlID0ge1xuICByZW1vdmVDYXJ0SXRlbTogUmVtb3ZlQ2FydEl0ZW1QYXlsb2FkO1xufTtcblxuZXhwb3J0IGNsYXNzIFJlbW92ZUNhcnRJdGVtTXV0YXRpb24gZXh0ZW5kcyBNdXRhdGlvbjxSZW1vdmVDYXJ0SXRlbVJlc3BvbnNlLCBPcGVyYXRpb25JbnB1dDxSZW1vdmVDYXJ0SXRlbUlucHV0Pj4ge1xuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIG11dGF0aW9uOiBSRU1PVkVfQ0FSVF9JVEVNLFxuICAgIHJlZmV0Y2hRdWVyaWVzOiBbJ0NhcnQnLCAnTWluaUNhcnQnLCAnQ2hlY2tvdXRTdGF0ZSddLFxuICAgIGF3YWl0UmVmZXRjaFF1ZXJpZXM6IHRydWUsXG4gICAgdXBkYXRlOiAoc3RvcmU6IGFueSwgeyBkYXRhOiB7IHJlbW92ZUNhcnRJdGVtIH0gfTogYW55KSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gc3RvcmUucmVhZFF1ZXJ5KHtcbiAgICAgICAgcXVlcnk6IEdFVF9DQVJUXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdXBkYXRlZENhcnQgPSB7fTtcblxuICAgICAgaWYgKHJlbW92ZUNhcnRJdGVtKSB7XG4gICAgICAgIGNvbnN0IHsgaWQgfSA9IHJlbW92ZUNhcnRJdGVtO1xuXG4gICAgICAgIHVwZGF0ZWRDYXJ0WydpdGVtcyddID0gZGF0YS5jYXJ0Lml0ZW1zLmZpbHRlcigoaXRlbTogYW55KSA9PiBpdGVtLmlkICE9PSBpZCk7XG4gICAgICAgIHVwZGF0ZWRDYXJ0WydpdGVtc1F0eSddID0gZGF0YS5jYXJ0Lml0ZW1zLmxlbmd0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNvbWV0aGluZyBpc24ndCByaWdodC4uIGNsZWFyIHRoZSBlbnRpcmUgY2FydC5cbiAgICAgICAgLy8gYHJlbW92ZUNhcnRJdGVtYCBjYW4gYmUgYG51bGxgIGlmIHRoZSB1c2VyIGFkZHMgc29tZXRoaW5nIHRvIHRoZWlyIGNhcnQgYW5kIHRoZW4gbG9ncyBvdXRcbiAgICAgICAgdXBkYXRlZENhcnRbJ2l0ZW1zJ10gPSBbXTtcbiAgICAgICAgdXBkYXRlZENhcnRbJ2l0ZW1zUXR5J10gPSBkYXRhLmNhcnQuaXRlbXMubGVuZ3RoO1xuICAgICAgfVxuXG4gICAgICBzdG9yZS53cml0ZVF1ZXJ5KHtcbiAgICAgICAgcXVlcnk6IEdFVF9DQVJULFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgICBjYXJ0OiB7XG4gICAgICAgICAgICAuLi5kYXRhLmNhcnQsXG4gICAgICAgICAgICAuLi51cGRhdGVkQ2FydFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xufVxuIl19