"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.AdyenCCPlugin = void 0;

var _inheritsLoose2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/inheritsLoose"));

var _falconPaymentPlugin = /*#__PURE__*/require("@deity/falcon-payment-plugin");

// eslint-disable-next-line import/order
var adyen = /*#__PURE__*/require('adyen-cse-web');

var AdyenCCPlugin = /*#__PURE__*/function (_PaymentPluginModel) {
  (0, _inheritsLoose2.default)(AdyenCCPlugin, _PaymentPluginModel);

  function AdyenCCPlugin(props) {
    var _this;

    _this = _PaymentPluginModel.call(this, props) || this;
    _this.cseInstance = void 0;

    _this.setCreditCardData = function (data) {
      _this.encryptCreditCard(data);
    };

    var key = _this.props.config.key;
    _this.cseInstance = adyen.createEncryption(key, {});
    return _this;
  }

  var _proto = AdyenCCPlugin.prototype;

  _proto.encryptCreditCard = function encryptCreditCard(_ref) {
    var number = _ref.number,
        expiry = _ref.expiry,
        cvc = _ref.cvc,
        name = _ref.name;
    var expiryMonth = expiry.split('/')[0].trim();
    var expiryYear = expiry.split('/')[1].trim();

    if (expiryYear.length === 2) {
      // Adding `20xx` prefix for 2-digit year
      expiryYear = "20" + expiryYear;
    }

    var creditCard = {
      holderName: name,
      number: number.replace(/ /g, ''),
      cvc: cvc,
      expiryMonth: expiryMonth,
      expiryYear: expiryYear,
      generationtime: new Date().toISOString()
    };
    var encryptedData = this.cseInstance.encrypt(creditCard);

    if (encryptedData) {
      this.props.onPaymentDetailsReady({
        cc_type: '',
        encrypted_data: encryptedData,
        store_cc: false
      });
    }
  };

  _proto.render = function render() {
    return this.props.children({
      setCreditCardData: this.setCreditCardData
    });
  };

  return AdyenCCPlugin;
}(_falconPaymentPlugin.PaymentPluginModel);

exports.AdyenCCPlugin = AdyenCCPlugin;
AdyenCCPlugin.icon = 'https://raw.githubusercontent.com/Adyen/adyen-magento2/develop/view/base/web/images/logos/creditcard.png';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BZHllbkNDUGx1Z2luLnRzeCJdLCJuYW1lcyI6WyJhZHllbiIsInJlcXVpcmUiLCJBZHllbkNDUGx1Z2luIiwicHJvcHMiLCJjc2VJbnN0YW5jZSIsInNldENyZWRpdENhcmREYXRhIiwiZGF0YSIsImVuY3J5cHRDcmVkaXRDYXJkIiwia2V5IiwiY29uZmlnIiwiY3JlYXRlRW5jcnlwdGlvbiIsIm51bWJlciIsImV4cGlyeSIsImN2YyIsIm5hbWUiLCJleHBpcnlNb250aCIsInNwbGl0IiwidHJpbSIsImV4cGlyeVllYXIiLCJsZW5ndGgiLCJjcmVkaXRDYXJkIiwiaG9sZGVyTmFtZSIsInJlcGxhY2UiLCJnZW5lcmF0aW9udGltZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImVuY3J5cHRlZERhdGEiLCJlbmNyeXB0Iiwib25QYXltZW50RGV0YWlsc1JlYWR5IiwiY2NfdHlwZSIsImVuY3J5cHRlZF9kYXRhIiwic3RvcmVfY2MiLCJyZW5kZXIiLCJjaGlsZHJlbiIsIlBheW1lbnRQbHVnaW5Nb2RlbCIsImljb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUVBOztBQURBO0FBR0EsSUFBTUEsS0FBSyxnQkFBR0MsT0FBTyxDQUFDLGVBQUQsQ0FBckI7O0lBZ0JhQyxhOzs7QUFNWCx5QkFBWUMsS0FBWixFQUErQjtBQUFBOztBQUM3QiwyQ0FBTUEsS0FBTjtBQUQ2QixVQUZ2QkMsV0FFdUI7O0FBQUEsVUFpQy9CQyxpQkFqQytCLEdBaUNYLFVBQUNDLElBQUQsRUFBMEI7QUFDNUMsWUFBS0MsaUJBQUwsQ0FBdUJELElBQXZCO0FBQ0QsS0FuQzhCOztBQUc3QixRQUFRRSxHQUFSLEdBQWdCLE1BQUtMLEtBQUwsQ0FBV00sTUFBM0IsQ0FBUUQsR0FBUjtBQUNBLFVBQUtKLFdBQUwsR0FBbUJKLEtBQUssQ0FBQ1UsZ0JBQU4sQ0FBdUJGLEdBQXZCLEVBQTRCLEVBQTVCLENBQW5CO0FBSjZCO0FBSzlCOzs7O1NBRURELGlCLEdBQUEsaUNBQWlFO0FBQUEsUUFBN0NJLE1BQTZDLFFBQTdDQSxNQUE2QztBQUFBLFFBQXJDQyxNQUFxQyxRQUFyQ0EsTUFBcUM7QUFBQSxRQUE3QkMsR0FBNkIsUUFBN0JBLEdBQTZCO0FBQUEsUUFBeEJDLElBQXdCLFFBQXhCQSxJQUF3QjtBQUMvRCxRQUFNQyxXQUFXLEdBQUdILE1BQU0sQ0FBQ0ksS0FBUCxDQUFhLEdBQWIsRUFBa0IsQ0FBbEIsRUFBcUJDLElBQXJCLEVBQXBCO0FBQ0EsUUFBSUMsVUFBVSxHQUFHTixNQUFNLENBQUNJLEtBQVAsQ0FBYSxHQUFiLEVBQWtCLENBQWxCLEVBQXFCQyxJQUFyQixFQUFqQjs7QUFDQSxRQUFJQyxVQUFVLENBQUNDLE1BQVgsS0FBc0IsQ0FBMUIsRUFBNkI7QUFDM0I7QUFDQUQsTUFBQUEsVUFBVSxVQUFRQSxVQUFsQjtBQUNEOztBQUVELFFBQU1FLFVBQVUsR0FBRztBQUNqQkMsTUFBQUEsVUFBVSxFQUFFUCxJQURLO0FBRWpCSCxNQUFBQSxNQUFNLEVBQUVBLE1BQU0sQ0FBQ1csT0FBUCxDQUFlLElBQWYsRUFBcUIsRUFBckIsQ0FGUztBQUdqQlQsTUFBQUEsR0FBRyxFQUFIQSxHQUhpQjtBQUlqQkUsTUFBQUEsV0FBVyxFQUFYQSxXQUppQjtBQUtqQkcsTUFBQUEsVUFBVSxFQUFWQSxVQUxpQjtBQU1qQkssTUFBQUEsY0FBYyxFQUFFLElBQUlDLElBQUosR0FBV0MsV0FBWDtBQU5DLEtBQW5CO0FBUUEsUUFBTUMsYUFBYSxHQUFHLEtBQUt0QixXQUFMLENBQWlCdUIsT0FBakIsQ0FBeUJQLFVBQXpCLENBQXRCOztBQUNBLFFBQUlNLGFBQUosRUFBbUI7QUFDakIsV0FBS3ZCLEtBQUwsQ0FBV3lCLHFCQUFYLENBQWlDO0FBQy9CQyxRQUFBQSxPQUFPLEVBQUUsRUFEc0I7QUFFL0JDLFFBQUFBLGNBQWMsRUFBRUosYUFGZTtBQUcvQkssUUFBQUEsUUFBUSxFQUFFO0FBSHFCLE9BQWpDO0FBS0Q7QUFDRixHOztTQU1EQyxNLEdBQUEsa0JBQVM7QUFDUCxXQUFPLEtBQUs3QixLQUFMLENBQVc4QixRQUFYLENBQW9CO0FBQ3pCNUIsTUFBQUEsaUJBQWlCLEVBQUUsS0FBS0E7QUFEQyxLQUFwQixDQUFQO0FBR0QsRzs7O0VBL0NnQzZCLHVDOzs7QUFBdEJoQyxhLENBQ0ppQyxJLEdBQ0wsMEciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9vcmRlclxuaW1wb3J0IHsgUGF5bWVudFBsdWdpbk1vZGVsLCBQYXltZW50UGx1Z2luQ29tcG9uZW50UHJvcHMgfSBmcm9tICdAZGVpdHkvZmFsY29uLXBheW1lbnQtcGx1Z2luJztcblxuY29uc3QgYWR5ZW4gPSByZXF1aXJlKCdhZHllbi1jc2Utd2ViJyk7XG5cbmV4cG9ydCB0eXBlIEFkeWVuUHJvcHMgPSBQYXltZW50UGx1Z2luQ29tcG9uZW50UHJvcHMgJiB7XG4gIGNvbmZpZzoge1xuICAgIGtleTogc3RyaW5nO1xuICB9O1xuICBjaGlsZHJlbjogKGFyZ3M6IGFueSkgPT4gUmVhY3QuUmVhY3ROb2RlO1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBDcmVkaXRDYXJkRGF0YSB7XG4gIG51bWJlcjogc3RyaW5nO1xuICBleHBpcnk6IHN0cmluZztcbiAgY3ZjOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIEFkeWVuQ0NQbHVnaW4gZXh0ZW5kcyBQYXltZW50UGx1Z2luTW9kZWw8QWR5ZW5Qcm9wcz4ge1xuICBzdGF0aWMgaWNvbjogc3RyaW5nID1cbiAgICAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FkeWVuL2FkeWVuLW1hZ2VudG8yL2RldmVsb3Avdmlldy9iYXNlL3dlYi9pbWFnZXMvbG9nb3MvY3JlZGl0Y2FyZC5wbmcnO1xuXG4gIHByaXZhdGUgY3NlSW5zdGFuY2U6IGFueTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogQWR5ZW5Qcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIGNvbnN0IHsga2V5IH0gPSB0aGlzLnByb3BzLmNvbmZpZztcbiAgICB0aGlzLmNzZUluc3RhbmNlID0gYWR5ZW4uY3JlYXRlRW5jcnlwdGlvbihrZXksIHt9KTtcbiAgfVxuXG4gIGVuY3J5cHRDcmVkaXRDYXJkKHsgbnVtYmVyLCBleHBpcnksIGN2YywgbmFtZSB9OiBDcmVkaXRDYXJkRGF0YSkge1xuICAgIGNvbnN0IGV4cGlyeU1vbnRoID0gZXhwaXJ5LnNwbGl0KCcvJylbMF0udHJpbSgpO1xuICAgIGxldCBleHBpcnlZZWFyID0gZXhwaXJ5LnNwbGl0KCcvJylbMV0udHJpbSgpO1xuICAgIGlmIChleHBpcnlZZWFyLmxlbmd0aCA9PT0gMikge1xuICAgICAgLy8gQWRkaW5nIGAyMHh4YCBwcmVmaXggZm9yIDItZGlnaXQgeWVhclxuICAgICAgZXhwaXJ5WWVhciA9IGAyMCR7ZXhwaXJ5WWVhcn1gO1xuICAgIH1cblxuICAgIGNvbnN0IGNyZWRpdENhcmQgPSB7XG4gICAgICBob2xkZXJOYW1lOiBuYW1lLFxuICAgICAgbnVtYmVyOiBudW1iZXIucmVwbGFjZSgvIC9nLCAnJyksXG4gICAgICBjdmMsXG4gICAgICBleHBpcnlNb250aCxcbiAgICAgIGV4cGlyeVllYXIsXG4gICAgICBnZW5lcmF0aW9udGltZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcbiAgICBjb25zdCBlbmNyeXB0ZWREYXRhID0gdGhpcy5jc2VJbnN0YW5jZS5lbmNyeXB0KGNyZWRpdENhcmQpO1xuICAgIGlmIChlbmNyeXB0ZWREYXRhKSB7XG4gICAgICB0aGlzLnByb3BzLm9uUGF5bWVudERldGFpbHNSZWFkeSh7XG4gICAgICAgIGNjX3R5cGU6ICcnLFxuICAgICAgICBlbmNyeXB0ZWRfZGF0YTogZW5jcnlwdGVkRGF0YSxcbiAgICAgICAgc3RvcmVfY2M6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzZXRDcmVkaXRDYXJkRGF0YSA9IChkYXRhOiBDcmVkaXRDYXJkRGF0YSkgPT4ge1xuICAgIHRoaXMuZW5jcnlwdENyZWRpdENhcmQoZGF0YSk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmNoaWxkcmVuKHtcbiAgICAgIHNldENyZWRpdENhcmREYXRhOiB0aGlzLnNldENyZWRpdENhcmREYXRhXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==