{"version":3,"file":"falcon-adyen-plugin.cjs.js","sources":["../src/AdyenCCPlugin.tsx"],"sourcesContent":["import React from 'react';\n// eslint-disable-next-line import/order\nimport { PaymentPluginModel, PaymentPluginComponentProps } from '@deity/falcon-payment-plugin';\n\nconst adyen = require('adyen-cse-web');\n\nexport type AdyenProps = PaymentPluginComponentProps & {\n  config: {\n    key: string;\n  };\n  children: (args: any) => React.ReactNode;\n};\n\nexport interface CreditCardData {\n  number: string;\n  expiry: string;\n  cvc: string;\n  name: string;\n}\n\nexport class AdyenCCPlugin extends PaymentPluginModel<AdyenProps> {\n  static icon: string =\n    'https://raw.githubusercontent.com/Adyen/adyen-magento2/develop/view/base/web/images/logos/creditcard.png';\n\n  private cseInstance: any;\n\n  constructor(props: AdyenProps) {\n    super(props);\n\n    const { key } = this.props.config;\n    this.cseInstance = adyen.createEncryption(key, {});\n  }\n\n  encryptCreditCard({ number, expiry, cvc, name }: CreditCardData) {\n    const expiryMonth = expiry.split('/')[0].trim();\n    let expiryYear = expiry.split('/')[1].trim();\n    if (expiryYear.length === 2) {\n      // Adding `20xx` prefix for 2-digit year\n      expiryYear = `20${expiryYear}`;\n    }\n\n    const creditCard = {\n      holderName: name,\n      number: number.replace(/ /g, ''),\n      cvc,\n      expiryMonth,\n      expiryYear,\n      generationtime: new Date().toISOString()\n    };\n    const encryptedData = this.cseInstance.encrypt(creditCard);\n    if (encryptedData) {\n      this.props.onPaymentDetailsReady({\n        cc_type: '',\n        encrypted_data: encryptedData,\n        store_cc: false\n      });\n    }\n  }\n\n  setCreditCardData = (data: CreditCardData) => {\n    this.encryptCreditCard(data);\n  };\n\n  render() {\n    return this.props.children({\n      setCreditCardData: this.setCreditCardData\n    });\n  }\n}\n"],"names":["adyen","require","AdyenCCPlugin","PaymentPluginModel","constructor","props","cseInstance","setCreditCardData","data","encryptCreditCard","key","config","createEncryption","number","expiry","cvc","name","expiryMonth","split","trim","expiryYear","length","creditCard","holderName","replace","generationtime","Date","toISOString","encryptedData","encrypt","onPaymentDetailsReady","cc_type","encrypted_data","store_cc","render","children","icon"],"mappings":";;;;AACA;AACA;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,eAAD,CAArB;;AAgBA,AAAO,MAAMC,aAAN,SAA4BC,sCAA5B,CAA2D;EAMhEC,WAAW,CAACC,KAAD,EAAoB;UACvBA,KAAN;SAHMC,WAEuB;;SAiC/BC,iBAjC+B,GAiCVC,IAAD,IAA0B;WACvCC,iBAAL,CAAuBD,IAAvB;KAlC6B;;UAGvB;MAAEE;QAAQ,KAAKL,KAAL,CAAWM,MAA3B;SACKL,WAAL,GAAmBN,KAAK,CAACY,gBAAN,CAAuBF,GAAvB,EAA4B,EAA5B,CAAnB;;;EAGFD,iBAAiB,CAAC;IAAEI,MAAF;IAAUC,MAAV;IAAkBC,GAAlB;IAAuBC;GAAxB,EAAgD;UACzDC,WAAW,GAAGH,MAAM,CAACI,KAAP,CAAa,GAAb,EAAkB,CAAlB,EAAqBC,IAArB,EAApB;QACIC,UAAU,GAAGN,MAAM,CAACI,KAAP,CAAa,GAAb,EAAkB,CAAlB,EAAqBC,IAArB,EAAjB;;QACIC,UAAU,CAACC,MAAX,KAAsB,CAA1B,EAA6B;;MAE3BD,UAAU,GAAI,KAAIA,UAAW,EAA7B;;;UAGIE,UAAU,GAAG;MACjBC,UAAU,EAAEP,IADK;MAEjBH,MAAM,EAAEA,MAAM,CAACW,OAAP,CAAe,IAAf,EAAqB,EAArB,CAFS;MAGjBT,GAHiB;MAIjBE,WAJiB;MAKjBG,UALiB;MAMjBK,cAAc,EAAE,IAAIC,IAAJ,GAAWC,WAAX;KANlB;UAQMC,aAAa,GAAG,KAAKtB,WAAL,CAAiBuB,OAAjB,CAAyBP,UAAzB,CAAtB;;QACIM,aAAJ,EAAmB;WACZvB,KAAL,CAAWyB,qBAAX,CAAiC;QAC/BC,OAAO,EAAE,EADsB;QAE/BC,cAAc,EAAEJ,aAFe;QAG/BK,QAAQ,EAAE;OAHZ;;;;EAYJC,MAAM,GAAG;WACA,KAAK7B,KAAL,CAAW8B,QAAX,CAAoB;MACzB5B,iBAAiB,EAAE,KAAKA;KADnB,CAAP;;;;AA5CSL,cACJkC,OACL;;;;"}