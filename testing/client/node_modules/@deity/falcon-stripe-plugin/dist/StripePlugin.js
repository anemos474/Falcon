"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.StripePlugin = void 0;

var _regenerator = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/asyncToGenerator"));

var _Loader = /*#__PURE__*/require("./Loader");

/**
 * Testing docs - https://stripe.com/docs/testing#cards
 */
var StripeCard = function StripeCard(props) {
  var stripe = props.stripe,
      config = props.config,
      children = props.children;
  var clientSecret = config.clientSecret;
  var cardElement = props.elements.getElement('card');

  var payFn = /*#__PURE__*/function () {
    var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {
      return _regenerator.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              return _context.abrupt("return", stripe.confirmCardPayment(clientSecret, {
                payment_method: {
                  card: cardElement
                }
              }).then(function (_ref2) {
                var paymentIntent = _ref2.paymentIntent,
                    error = _ref2.error;

                if (error) {
                  return Promise.reject(new Error(error.message));
                }

                if (paymentIntent && paymentIntent.status === 'succeeded') {
                  return {
                    intentId: paymentIntent.id
                  };
                }

                throw new Error("Payment failed. Status: " + paymentIntent.status);
              }));

            case 1:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function payFn() {
      return _ref.apply(this, arguments);
    };
  }();

  return children(payFn);
};

var StripePlugin = /*#__PURE__*/(0, _Loader.withStripe)(StripeCard);
exports.StripePlugin = StripePlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TdHJpcGVQbHVnaW4udHN4Il0sIm5hbWVzIjpbIlN0cmlwZUNhcmQiLCJwcm9wcyIsInN0cmlwZSIsImNvbmZpZyIsImNoaWxkcmVuIiwiY2xpZW50U2VjcmV0IiwiY2FyZEVsZW1lbnQiLCJlbGVtZW50cyIsImdldEVsZW1lbnQiLCJwYXlGbiIsImNvbmZpcm1DYXJkUGF5bWVudCIsInBheW1lbnRfbWV0aG9kIiwiY2FyZCIsInRoZW4iLCJwYXltZW50SW50ZW50IiwiZXJyb3IiLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiLCJtZXNzYWdlIiwic3RhdHVzIiwiaW50ZW50SWQiLCJpZCIsIlN0cmlwZVBsdWdpbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFDQTs7QUFTQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQSxVQUF1QyxHQUFHLFNBQTFDQSxVQUEwQyxDQUFBQyxLQUFLLEVBQUk7QUFDdkQsTUFBUUMsTUFBUixHQUFxQ0QsS0FBckMsQ0FBUUMsTUFBUjtBQUFBLE1BQWdCQyxNQUFoQixHQUFxQ0YsS0FBckMsQ0FBZ0JFLE1BQWhCO0FBQUEsTUFBd0JDLFFBQXhCLEdBQXFDSCxLQUFyQyxDQUF3QkcsUUFBeEI7QUFDQSxNQUFRQyxZQUFSLEdBQXlCRixNQUF6QixDQUFRRSxZQUFSO0FBQ0EsTUFBTUMsV0FBVyxHQUFHTCxLQUFLLENBQUNNLFFBQU4sQ0FBZUMsVUFBZixDQUEwQixNQUExQixDQUFwQjs7QUFFQSxNQUFNQyxLQUFLO0FBQUEsdUZBQUc7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLCtDQUNaUCxNQUFNLENBQ0hRLGtCQURILENBQ3NCTCxZQUR0QixFQUNvQztBQUNoQ00sZ0JBQUFBLGNBQWMsRUFBRTtBQUNkQyxrQkFBQUEsSUFBSSxFQUFFTjtBQURRO0FBRGdCLGVBRHBDLEVBTUdPLElBTkgsQ0FNUSxpQkFBOEI7QUFBQSxvQkFBM0JDLGFBQTJCLFNBQTNCQSxhQUEyQjtBQUFBLG9CQUFaQyxLQUFZLFNBQVpBLEtBQVk7O0FBQ2xDLG9CQUFJQSxLQUFKLEVBQVc7QUFDVCx5QkFBT0MsT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVSCxLQUFLLENBQUNJLE9BQWhCLENBQWYsQ0FBUDtBQUNEOztBQUVELG9CQUFJTCxhQUFhLElBQUlBLGFBQWEsQ0FBQ00sTUFBZCxLQUF5QixXQUE5QyxFQUEyRDtBQUN6RCx5QkFBTztBQUNMQyxvQkFBQUEsUUFBUSxFQUFFUCxhQUFhLENBQUNRO0FBRG5CLG1CQUFQO0FBR0Q7O0FBQ0Qsc0JBQU0sSUFBSUosS0FBSiw4QkFBcUNKLGFBQWEsQ0FBQ00sTUFBbkQsQ0FBTjtBQUNELGVBakJILENBRFk7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsS0FBSDs7QUFBQSxvQkFBTFgsS0FBSztBQUFBO0FBQUE7QUFBQSxLQUFYOztBQW9CQSxTQUFPTCxRQUFRLENBQUNLLEtBQUQsQ0FBZjtBQUNELENBMUJEOztBQTRCTyxJQUFNYyxZQUFZLGdCQUFHLHdCQUFXdkIsVUFBWCxDQUFyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBSZWFjdEVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB3aXRoU3RyaXBlIH0gZnJvbSAnLi9Mb2FkZXInO1xuXG5leHBvcnQgdHlwZSBTdHJpcGVQbHVnaW5UeXBlcyA9IHtcbiAgc3RyaXBlOiBzdHJpcGUuU3RyaXBlO1xuICBjb25maWc6IGFueTtcbiAgY2hpbGRyZW4oYXJnMDogYW55KTogUmVhY3RFbGVtZW50O1xuICBlbGVtZW50czogYW55O1xufTtcblxuLyoqXG4gKiBUZXN0aW5nIGRvY3MgLSBodHRwczovL3N0cmlwZS5jb20vZG9jcy90ZXN0aW5nI2NhcmRzXG4gKi9cbmNvbnN0IFN0cmlwZUNhcmQ6IFJlYWN0LkZDPFN0cmlwZVBsdWdpblR5cGVzPiA9IHByb3BzID0+IHtcbiAgY29uc3QgeyBzdHJpcGUsIGNvbmZpZywgY2hpbGRyZW4gfSA9IHByb3BzO1xuICBjb25zdCB7IGNsaWVudFNlY3JldCB9ID0gY29uZmlnO1xuICBjb25zdCBjYXJkRWxlbWVudCA9IHByb3BzLmVsZW1lbnRzLmdldEVsZW1lbnQoJ2NhcmQnKTtcblxuICBjb25zdCBwYXlGbiA9IGFzeW5jICgpID0+XG4gICAgc3RyaXBlXG4gICAgICAuY29uZmlybUNhcmRQYXltZW50KGNsaWVudFNlY3JldCwge1xuICAgICAgICBwYXltZW50X21ldGhvZDoge1xuICAgICAgICAgIGNhcmQ6IGNhcmRFbGVtZW50XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAudGhlbigoeyBwYXltZW50SW50ZW50LCBlcnJvciB9KSA9PiB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoZXJyb3IubWVzc2FnZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBheW1lbnRJbnRlbnQgJiYgcGF5bWVudEludGVudC5zdGF0dXMgPT09ICdzdWNjZWVkZWQnKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGludGVudElkOiBwYXltZW50SW50ZW50LmlkXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFBheW1lbnQgZmFpbGVkLiBTdGF0dXM6ICR7cGF5bWVudEludGVudC5zdGF0dXN9YCk7XG4gICAgICB9KTtcblxuICByZXR1cm4gY2hpbGRyZW4ocGF5Rm4pO1xufTtcblxuZXhwb3J0IGNvbnN0IFN0cmlwZVBsdWdpbiA9IHdpdGhTdHJpcGUoU3RyaXBlQ2FyZCk7XG4iXX0=