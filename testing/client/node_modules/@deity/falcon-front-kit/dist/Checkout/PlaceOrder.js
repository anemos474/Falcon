"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.PlaceOrder = exports.usePlaceOrder = void 0;

var _regenerator = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/asyncToGenerator"));

var _react = /*#__PURE__*/require("react");

var _falconShopData = /*#__PURE__*/require("@deity/falcon-shop-data");

var _CheckoutAddress = /*#__PURE__*/require("./CheckoutAddress");

var _CheckoutConsumer = /*#__PURE__*/require("./CheckoutConsumer");

var _shippingMethodToCheckoutDetailsInput = /*#__PURE__*/require("./shippingMethodToCheckoutDetailsInput");

var _PaymentMethodData = /*#__PURE__*/require("./PaymentMethodData");

var usePlaceOrder = function usePlaceOrder() {
  var _useCheckout = (0, _CheckoutConsumer.useCheckout)(),
      isLoading = _useCheckout.isLoading,
      setLoading = _useCheckout.setLoading,
      setOrderData = _useCheckout.setOrderData,
      setResult = _useCheckout.setResult;

  var _usePlaceOrderMutatio = (0, _falconShopData.usePlaceOrderMutation)({
    onCompleted: function onCompleted(data) {
      if (data) {
        setResult(data.placeOrder);
        setLoading(false);
      }
    }
  }),
      mutation = _usePlaceOrderMutatio[0],
      result = _usePlaceOrderMutatio[1];

  if (result.loading !== isLoading) {
    setLoading(result.loading);
  }

  return [(0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(input, options) {
      return _regenerator.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              setLoading(true);
              setOrderData(input);
              return _context.abrupt("return", mutation(Object.assign({}, options || {}, {
                variables: {
                  input: {
                    email: input.email,
                    billingAddress: (0, _CheckoutAddress.addressToCheckoutAddressInput)(input.billingAddress),
                    shippingAddress: (0, _CheckoutAddress.addressToCheckoutAddressInput)(input.shippingAddress),
                    shippingMethod: (0, _shippingMethodToCheckoutDetailsInput.shippingMethodToCheckoutDetailsInput)(input.shippingMethod),
                    paymentMethod: input.paymentMethod ? (0, _PaymentMethodData.paymentMethodToCheckoutDetailsInput)(input.paymentMethod) : null
                  }
                }
              })));

            case 3:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }(), [setLoading, setOrderData, mutation]), result];
};

exports.usePlaceOrder = usePlaceOrder;

var PlaceOrder = function PlaceOrder(_ref2) {
  var children = _ref2.children;
  return children.apply(void 0, usePlaceOrder());
};

exports.PlaceOrder = PlaceOrder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DaGVja291dC9QbGFjZU9yZGVyLnRzeCJdLCJuYW1lcyI6WyJ1c2VQbGFjZU9yZGVyIiwiaXNMb2FkaW5nIiwic2V0TG9hZGluZyIsInNldE9yZGVyRGF0YSIsInNldFJlc3VsdCIsIm9uQ29tcGxldGVkIiwiZGF0YSIsInBsYWNlT3JkZXIiLCJtdXRhdGlvbiIsInJlc3VsdCIsImxvYWRpbmciLCJpbnB1dCIsIm9wdGlvbnMiLCJ2YXJpYWJsZXMiLCJlbWFpbCIsImJpbGxpbmdBZGRyZXNzIiwic2hpcHBpbmdBZGRyZXNzIiwic2hpcHBpbmdNZXRob2QiLCJwYXltZW50TWV0aG9kIiwiUGxhY2VPcmRlciIsImNoaWxkcmVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUVBOztBQUNBOztBQUVPLElBQU1BLGFBQStFLEdBQUcsU0FBbEZBLGFBQWtGLEdBQU07QUFDbkcscUJBQTJELG9DQUEzRDtBQUFBLE1BQVFDLFNBQVIsZ0JBQVFBLFNBQVI7QUFBQSxNQUFtQkMsVUFBbkIsZ0JBQW1CQSxVQUFuQjtBQUFBLE1BQStCQyxZQUEvQixnQkFBK0JBLFlBQS9CO0FBQUEsTUFBNkNDLFNBQTdDLGdCQUE2Q0EsU0FBN0M7O0FBQ0EsOEJBQTJCLDJDQUFzQjtBQUMvQ0MsSUFBQUEsV0FBVyxFQUFFLHFCQUFBQyxJQUFJLEVBQUk7QUFDbkIsVUFBSUEsSUFBSixFQUFVO0FBQ1JGLFFBQUFBLFNBQVMsQ0FBQ0UsSUFBSSxDQUFDQyxVQUFOLENBQVQ7QUFDQUwsUUFBQUEsVUFBVSxDQUFDLEtBQUQsQ0FBVjtBQUNEO0FBQ0Y7QUFOOEMsR0FBdEIsQ0FBM0I7QUFBQSxNQUFPTSxRQUFQO0FBQUEsTUFBaUJDLE1BQWpCOztBQVNBLE1BQUlBLE1BQU0sQ0FBQ0MsT0FBUCxLQUFtQlQsU0FBdkIsRUFBa0M7QUFDaENDLElBQUFBLFVBQVUsQ0FBQ08sTUFBTSxDQUFDQyxPQUFSLENBQVY7QUFDRDs7QUFFRCxTQUFPLENBQ0w7QUFBQSx1RkFDRSxpQkFBT0MsS0FBUCxFQUF5QkMsT0FBekI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNFVixjQUFBQSxVQUFVLENBQUMsSUFBRCxDQUFWO0FBQ0FDLGNBQUFBLFlBQVksQ0FBQ1EsS0FBRCxDQUFaO0FBRkYsK0NBSVNILFFBQVEsbUJBQ1RJLE9BQU8sSUFBSSxFQURGO0FBRWJDLGdCQUFBQSxTQUFTLEVBQUU7QUFDVEYsa0JBQUFBLEtBQUssRUFBRTtBQUNMRyxvQkFBQUEsS0FBSyxFQUFFSCxLQUFLLENBQUNHLEtBRFI7QUFFTEMsb0JBQUFBLGNBQWMsRUFBRSxvREFBOEJKLEtBQUssQ0FBQ0ksY0FBcEMsQ0FGWDtBQUdMQyxvQkFBQUEsZUFBZSxFQUFFLG9EQUE4QkwsS0FBSyxDQUFDSyxlQUFwQyxDQUhaO0FBSUxDLG9CQUFBQSxjQUFjLEVBQUUsZ0ZBQXFDTixLQUFLLENBQUNNLGNBQTNDLENBSlg7QUFLTEMsb0JBQUFBLGFBQWEsRUFBRVAsS0FBSyxDQUFDTyxhQUFOLEdBQXNCLDREQUFvQ1AsS0FBSyxDQUFDTyxhQUExQyxDQUF0QixHQUFpRjtBQUwzRjtBQURFO0FBRkUsaUJBSmpCOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEtBREY7O0FBQUE7QUFBQTtBQUFBO0FBQUEsT0FrQkUsQ0FBQ2hCLFVBQUQsRUFBYUMsWUFBYixFQUEyQkssUUFBM0IsQ0FsQkYsQ0FESyxFQXFCTEMsTUFyQkssQ0FBUDtBQXVCRCxDQXRDTTs7OztBQTJDQSxJQUFNVSxVQUFxQyxHQUFHLFNBQXhDQSxVQUF3QyxRQUFrQjtBQUFBLE1BQWZDLFFBQWUsU0FBZkEsUUFBZTtBQUNyRSxTQUFPQSxRQUFRLE1BQVIsU0FBWXBCLGFBQWEsRUFBekIsQ0FBUDtBQUNELENBRk0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB1c2VQbGFjZU9yZGVyTXV0YXRpb24sIFBsYWNlT3JkZXJSZXNwb25zZSB9IGZyb20gJ0BkZWl0eS9mYWxjb24tc2hvcC1kYXRhJztcbmltcG9ydCB7IGFkZHJlc3NUb0NoZWNrb3V0QWRkcmVzc0lucHV0IH0gZnJvbSAnLi9DaGVja291dEFkZHJlc3MnO1xuaW1wb3J0IHsgT3JkZXJEYXRhIH0gZnJvbSAnLi9DaGVja291dFZhbHVlcyc7XG5pbXBvcnQgeyB1c2VDaGVja291dCB9IGZyb20gJy4vQ2hlY2tvdXRDb25zdW1lcic7XG5pbXBvcnQgeyBDaGVja291dE9wZXJhdGlvbiwgQ2hlY2tvdXRPcGVyYXRpb25Ib29rIH0gZnJvbSAnLi9DaGVja291dE9wZXJhdGlvbic7XG5pbXBvcnQgeyBzaGlwcGluZ01ldGhvZFRvQ2hlY2tvdXREZXRhaWxzSW5wdXQgfSBmcm9tICcuL3NoaXBwaW5nTWV0aG9kVG9DaGVja291dERldGFpbHNJbnB1dCc7XG5pbXBvcnQgeyBwYXltZW50TWV0aG9kVG9DaGVja291dERldGFpbHNJbnB1dCB9IGZyb20gJy4vUGF5bWVudE1ldGhvZERhdGEnO1xuXG5leHBvcnQgY29uc3QgdXNlUGxhY2VPcmRlcjogQ2hlY2tvdXRPcGVyYXRpb25Ib29rPFBsYWNlT3JkZXJSZXNwb25zZSwgT3JkZXJEYXRhIHwgdW5kZWZpbmVkPiA9ICgpID0+IHtcbiAgY29uc3QgeyBpc0xvYWRpbmcsIHNldExvYWRpbmcsIHNldE9yZGVyRGF0YSwgc2V0UmVzdWx0IH0gPSB1c2VDaGVja291dCgpO1xuICBjb25zdCBbbXV0YXRpb24sIHJlc3VsdF0gPSB1c2VQbGFjZU9yZGVyTXV0YXRpb24oe1xuICAgIG9uQ29tcGxldGVkOiBkYXRhID0+IHtcbiAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgIHNldFJlc3VsdChkYXRhLnBsYWNlT3JkZXIpO1xuICAgICAgICBzZXRMb2FkaW5nKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGlmIChyZXN1bHQubG9hZGluZyAhPT0gaXNMb2FkaW5nKSB7XG4gICAgc2V0TG9hZGluZyhyZXN1bHQubG9hZGluZyk7XG4gIH1cblxuICByZXR1cm4gW1xuICAgIHVzZUNhbGxiYWNrKFxuICAgICAgYXN5bmMgKGlucHV0OiBPcmRlckRhdGEsIG9wdGlvbnMpID0+IHtcbiAgICAgICAgc2V0TG9hZGluZyh0cnVlKTtcbiAgICAgICAgc2V0T3JkZXJEYXRhKGlucHV0KTtcblxuICAgICAgICByZXR1cm4gbXV0YXRpb24oe1xuICAgICAgICAgIC4uLihvcHRpb25zIHx8IHt9KSxcbiAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgICAgIGVtYWlsOiBpbnB1dC5lbWFpbCxcbiAgICAgICAgICAgICAgYmlsbGluZ0FkZHJlc3M6IGFkZHJlc3NUb0NoZWNrb3V0QWRkcmVzc0lucHV0KGlucHV0LmJpbGxpbmdBZGRyZXNzKSxcbiAgICAgICAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiBhZGRyZXNzVG9DaGVja291dEFkZHJlc3NJbnB1dChpbnB1dC5zaGlwcGluZ0FkZHJlc3MpLFxuICAgICAgICAgICAgICBzaGlwcGluZ01ldGhvZDogc2hpcHBpbmdNZXRob2RUb0NoZWNrb3V0RGV0YWlsc0lucHV0KGlucHV0LnNoaXBwaW5nTWV0aG9kKSxcbiAgICAgICAgICAgICAgcGF5bWVudE1ldGhvZDogaW5wdXQucGF5bWVudE1ldGhvZCA/IHBheW1lbnRNZXRob2RUb0NoZWNrb3V0RGV0YWlsc0lucHV0KGlucHV0LnBheW1lbnRNZXRob2QpIDogbnVsbFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgW3NldExvYWRpbmcsIHNldE9yZGVyRGF0YSwgbXV0YXRpb25dXG4gICAgKSxcbiAgICByZXN1bHRcbiAgXTtcbn07XG5cbmV4cG9ydCB0eXBlIFBsYWNlT3JkZXJQcm9wcyA9IHtcbiAgY2hpbGRyZW46IENoZWNrb3V0T3BlcmF0aW9uPFBsYWNlT3JkZXJSZXNwb25zZSwgT3JkZXJEYXRhPjtcbn07XG5leHBvcnQgY29uc3QgUGxhY2VPcmRlcjogUmVhY3QuRkM8UGxhY2VPcmRlclByb3BzPiA9ICh7IGNoaWxkcmVuIH0pID0+IHtcbiAgcmV0dXJuIGNoaWxkcmVuKC4uLnVzZVBsYWNlT3JkZXIoKSk7XG59O1xuIl19