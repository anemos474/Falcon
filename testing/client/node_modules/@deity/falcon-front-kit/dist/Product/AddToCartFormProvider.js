"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.AddToCartFormProvider = void 0;

var _extends2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/extends"));

var _objectWithoutPropertiesLoose2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _react = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("react"));

var _formik = /*#__PURE__*/require("formik");

var _falconData = /*#__PURE__*/require("@deity/falcon-data");

var _falconShopData = /*#__PURE__*/require("@deity/falcon-shop-data");

var _React = /*#__PURE__*/require("../React");

var _productOptionMappers = /*#__PURE__*/require("./productOptionMappers");

var AddToCartFormProvider = function AddToCartFormProvider(props) {
  var onSuccess = props.onSuccess,
      initialValues = props.initialValues,
      quantity = props.quantity,
      product = props.product,
      mutationOptions = props.mutationOptions,
      formikProps = (0, _objectWithoutPropertiesLoose2.default)(props, ["onSuccess", "initialValues", "quantity", "product", "mutationOptions"]);
  var defaultInitialValues = {
    qty: quantity,
    options: (0, _productOptionMappers.productOptionsToForm)(product.options || []),
    bundleOptions: product.bundleOptions || []
  };

  var _useAddToCartMutation = (0, _falconShopData.useAddToCartMutation)(),
      addToCart = _useAddToCartMutation[0];

  var getUserError = (0, _falconData.useGetUserError)();
  var isMounted = (0, _React.useMounted)();
  return /*#__PURE__*/_react.default.createElement(_formik.Formik, (0, _extends2.default)({
    initialStatus: {},
    initialValues: initialValues || defaultInitialValues,
    onSubmit: function onSubmit(values, _ref) {
      var setSubmitting = _ref.setSubmitting,
          setStatus = _ref.setStatus;
      return addToCart(Object.assign({
        variables: {
          input: {
            sku: product.sku,
            qty: parseInt(values.qty.toString(), 10),
            options: (0, _productOptionMappers.formProductOptionsToInput)(values.options),
            bundleOptions: undefined // values.bundleOptions as any - TODO: add appropriate mapper

          }
        }
      }, mutationOptions || {})).then(function (_ref2) {
        var data = _ref2.data;

        if (isMounted.current) {
          setSubmitting(false);
          setStatus({
            data: data
          });
          return onSuccess && onSuccess(data);
        }
      }).catch(function (e) {
        var error = getUserError(e);

        if (error.length && isMounted.current) {
          setStatus({
            error: error
          });
          setSubmitting(false);
        }
      });
    }
  }, formikProps));
};

exports.AddToCartFormProvider = AddToCartFormProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Qcm9kdWN0L0FkZFRvQ2FydEZvcm1Qcm92aWRlci50c3giXSwibmFtZXMiOlsiQWRkVG9DYXJ0Rm9ybVByb3ZpZGVyIiwicHJvcHMiLCJvblN1Y2Nlc3MiLCJpbml0aWFsVmFsdWVzIiwicXVhbnRpdHkiLCJwcm9kdWN0IiwibXV0YXRpb25PcHRpb25zIiwiZm9ybWlrUHJvcHMiLCJkZWZhdWx0SW5pdGlhbFZhbHVlcyIsInF0eSIsIm9wdGlvbnMiLCJidW5kbGVPcHRpb25zIiwiYWRkVG9DYXJ0IiwiZ2V0VXNlckVycm9yIiwiaXNNb3VudGVkIiwidmFsdWVzIiwic2V0U3VibWl0dGluZyIsInNldFN0YXR1cyIsInZhcmlhYmxlcyIsImlucHV0Iiwic2t1IiwicGFyc2VJbnQiLCJ0b1N0cmluZyIsInVuZGVmaW5lZCIsInRoZW4iLCJkYXRhIiwiY3VycmVudCIsImNhdGNoIiwiZSIsImVycm9yIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUVBOztBQUNBOztBQWNPLElBQU1BLHFCQUE0RCxHQUFHLFNBQS9EQSxxQkFBK0QsQ0FBQUMsS0FBSyxFQUFJO0FBQ25GLE1BQVFDLFNBQVIsR0FBeUZELEtBQXpGLENBQVFDLFNBQVI7QUFBQSxNQUFtQkMsYUFBbkIsR0FBeUZGLEtBQXpGLENBQW1CRSxhQUFuQjtBQUFBLE1BQWtDQyxRQUFsQyxHQUF5RkgsS0FBekYsQ0FBa0NHLFFBQWxDO0FBQUEsTUFBNENDLE9BQTVDLEdBQXlGSixLQUF6RixDQUE0Q0ksT0FBNUM7QUFBQSxNQUFxREMsZUFBckQsR0FBeUZMLEtBQXpGLENBQXFESyxlQUFyRDtBQUFBLE1BQXlFQyxXQUF6RSwrQ0FBeUZOLEtBQXpGO0FBQ0EsTUFBTU8sb0JBQW9CLEdBQUc7QUFDM0JDLElBQUFBLEdBQUcsRUFBRUwsUUFEc0I7QUFFM0JNLElBQUFBLE9BQU8sRUFBRSxnREFBcUJMLE9BQU8sQ0FBQ0ssT0FBUixJQUFtQixFQUF4QyxDQUZrQjtBQUczQkMsSUFBQUEsYUFBYSxFQUFFTixPQUFPLENBQUNNLGFBQVIsSUFBeUI7QUFIYixHQUE3Qjs7QUFNQSw4QkFBb0IsMkNBQXBCO0FBQUEsTUFBT0MsU0FBUDs7QUFDQSxNQUFNQyxZQUFZLEdBQUcsa0NBQXJCO0FBQ0EsTUFBTUMsU0FBUyxHQUFHLHdCQUFsQjtBQUVBLHNCQUNFLDZCQUFDLGNBQUQ7QUFDRSxJQUFBLGFBQWEsRUFBRSxFQURqQjtBQUVFLElBQUEsYUFBYSxFQUFFWCxhQUFhLElBQUlLLG9CQUZsQztBQUdFLElBQUEsUUFBUSxFQUFFLGtCQUFDTyxNQUFEO0FBQUEsVUFBV0MsYUFBWCxRQUFXQSxhQUFYO0FBQUEsVUFBMEJDLFNBQTFCLFFBQTBCQSxTQUExQjtBQUFBLGFBQ1JMLFNBQVM7QUFDUE0sUUFBQUEsU0FBUyxFQUFFO0FBQ1RDLFVBQUFBLEtBQUssRUFBRTtBQUNMQyxZQUFBQSxHQUFHLEVBQUVmLE9BQU8sQ0FBQ2UsR0FEUjtBQUVMWCxZQUFBQSxHQUFHLEVBQUVZLFFBQVEsQ0FBQ04sTUFBTSxDQUFDTixHQUFQLENBQVdhLFFBQVgsRUFBRCxFQUF3QixFQUF4QixDQUZSO0FBR0xaLFlBQUFBLE9BQU8sRUFBRSxxREFBMEJLLE1BQU0sQ0FBQ0wsT0FBakMsQ0FISjtBQUlMQyxZQUFBQSxhQUFhLEVBQUVZLFNBSlYsQ0FJb0I7O0FBSnBCO0FBREU7QUFESixTQVNIakIsZUFBZSxJQUFJLEVBVGhCLEVBQVQsQ0FXR2tCLElBWEgsQ0FXUSxpQkFBYztBQUFBLFlBQVhDLElBQVcsU0FBWEEsSUFBVzs7QUFDbEIsWUFBSVgsU0FBUyxDQUFDWSxPQUFkLEVBQXVCO0FBQ3JCVixVQUFBQSxhQUFhLENBQUMsS0FBRCxDQUFiO0FBQ0FDLFVBQUFBLFNBQVMsQ0FBQztBQUFFUSxZQUFBQSxJQUFJLEVBQUpBO0FBQUYsV0FBRCxDQUFUO0FBQ0EsaUJBQU92QixTQUFTLElBQUlBLFNBQVMsQ0FBQ3VCLElBQUQsQ0FBN0I7QUFDRDtBQUNGLE9BakJILEVBa0JHRSxLQWxCSCxDQWtCUyxVQUFBQyxDQUFDLEVBQUk7QUFDVixZQUFNQyxLQUFLLEdBQUdoQixZQUFZLENBQUNlLENBQUQsQ0FBMUI7O0FBQ0EsWUFBSUMsS0FBSyxDQUFDQyxNQUFOLElBQWdCaEIsU0FBUyxDQUFDWSxPQUE5QixFQUF1QztBQUNyQ1QsVUFBQUEsU0FBUyxDQUFDO0FBQUVZLFlBQUFBLEtBQUssRUFBTEE7QUFBRixXQUFELENBQVQ7QUFDQWIsVUFBQUEsYUFBYSxDQUFDLEtBQUQsQ0FBYjtBQUNEO0FBQ0YsT0F4QkgsQ0FEUTtBQUFBO0FBSFosS0E4Qk1ULFdBOUJOLEVBREY7QUFrQ0QsQ0E5Q00iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRm9ybWlrIH0gZnJvbSAnZm9ybWlrJztcbmltcG9ydCB7IHVzZUdldFVzZXJFcnJvciB9IGZyb20gJ0BkZWl0eS9mYWxjb24tZGF0YSc7XG5pbXBvcnQgeyBQcm9kdWN0LCBQcm9kdWN0T3B0aW9uIH0gZnJvbSAnQGRlaXR5L2ZhbGNvbi1zaG9wLWV4dGVuc2lvbic7XG5pbXBvcnQgeyB1c2VBZGRUb0NhcnRNdXRhdGlvbiwgQWRkVG9DYXJ0UmVzcG9uc2UgfSBmcm9tICdAZGVpdHkvZmFsY29uLXNob3AtZGF0YSc7XG5pbXBvcnQgeyBGb3JtUHJvdmlkZXJQcm9wcyB9IGZyb20gJy4uL0Zvcm1zJztcbmltcG9ydCB7IHVzZU1vdW50ZWQgfSBmcm9tICcuLi9SZWFjdCc7XG5pbXBvcnQgeyBQcm9kdWN0T3B0aW9uc01hcCwgcHJvZHVjdE9wdGlvbnNUb0Zvcm0sIGZvcm1Qcm9kdWN0T3B0aW9uc1RvSW5wdXQgfSBmcm9tICcuL3Byb2R1Y3RPcHRpb25NYXBwZXJzJztcblxuZXhwb3J0IHR5cGUgQWRkVG9DYXJ0Rm9ybVZhbHVlcyA9IHtcbiAgcXR5OiBzdHJpbmc7XG4gIG9wdGlvbnM6IFByb2R1Y3RPcHRpb25zTWFwO1xuICBidW5kbGVPcHRpb25zOiBbXTtcbn07XG5leHBvcnQgdHlwZSBBZGRUb0NhcnRGb3JtUHJvdmlkZXJQcm9wcyA9IEZvcm1Qcm92aWRlclByb3BzPEFkZFRvQ2FydEZvcm1WYWx1ZXMsIEFkZFRvQ2FydFJlc3BvbnNlPiAmIHtcbiAgcXVhbnRpdHk6IG51bWJlcjtcbiAgcHJvZHVjdDogUGljazxQcm9kdWN0LCAnc2t1Jz4gJiB7XG4gICAgb3B0aW9ucz86IFBpY2s8UHJvZHVjdE9wdGlvbiwgJ2lkJz5bXTtcbiAgICBidW5kbGVPcHRpb25zPzogUGljazxQcm9kdWN0LCAnYnVuZGxlT3B0aW9ucyc+O1xuICB9O1xufTtcbmV4cG9ydCBjb25zdCBBZGRUb0NhcnRGb3JtUHJvdmlkZXI6IFJlYWN0LlNGQzxBZGRUb0NhcnRGb3JtUHJvdmlkZXJQcm9wcz4gPSBwcm9wcyA9PiB7XG4gIGNvbnN0IHsgb25TdWNjZXNzLCBpbml0aWFsVmFsdWVzLCBxdWFudGl0eSwgcHJvZHVjdCwgbXV0YXRpb25PcHRpb25zLCAuLi5mb3JtaWtQcm9wcyB9ID0gcHJvcHM7XG4gIGNvbnN0IGRlZmF1bHRJbml0aWFsVmFsdWVzID0ge1xuICAgIHF0eTogcXVhbnRpdHksXG4gICAgb3B0aW9uczogcHJvZHVjdE9wdGlvbnNUb0Zvcm0ocHJvZHVjdC5vcHRpb25zIHx8IFtdKSxcbiAgICBidW5kbGVPcHRpb25zOiBwcm9kdWN0LmJ1bmRsZU9wdGlvbnMgfHwgW11cbiAgfTtcblxuICBjb25zdCBbYWRkVG9DYXJ0XSA9IHVzZUFkZFRvQ2FydE11dGF0aW9uKCk7XG4gIGNvbnN0IGdldFVzZXJFcnJvciA9IHVzZUdldFVzZXJFcnJvcigpO1xuICBjb25zdCBpc01vdW50ZWQgPSB1c2VNb3VudGVkKCk7XG5cbiAgcmV0dXJuIChcbiAgICA8Rm9ybWlrXG4gICAgICBpbml0aWFsU3RhdHVzPXt7fX1cbiAgICAgIGluaXRpYWxWYWx1ZXM9e2luaXRpYWxWYWx1ZXMgfHwgZGVmYXVsdEluaXRpYWxWYWx1ZXN9XG4gICAgICBvblN1Ym1pdD17KHZhbHVlcywgeyBzZXRTdWJtaXR0aW5nLCBzZXRTdGF0dXMgfSkgPT5cbiAgICAgICAgYWRkVG9DYXJ0KHtcbiAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgICAgIHNrdTogcHJvZHVjdC5za3UsXG4gICAgICAgICAgICAgIHF0eTogcGFyc2VJbnQodmFsdWVzLnF0eS50b1N0cmluZygpLCAxMCksXG4gICAgICAgICAgICAgIG9wdGlvbnM6IGZvcm1Qcm9kdWN0T3B0aW9uc1RvSW5wdXQodmFsdWVzLm9wdGlvbnMpLFxuICAgICAgICAgICAgICBidW5kbGVPcHRpb25zOiB1bmRlZmluZWQgLy8gdmFsdWVzLmJ1bmRsZU9wdGlvbnMgYXMgYW55IC0gVE9ETzogYWRkIGFwcHJvcHJpYXRlIG1hcHBlclxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgLi4uKG11dGF0aW9uT3B0aW9ucyB8fCB7fSlcbiAgICAgICAgfSlcbiAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHtcbiAgICAgICAgICAgIGlmIChpc01vdW50ZWQuY3VycmVudCkge1xuICAgICAgICAgICAgICBzZXRTdWJtaXR0aW5nKGZhbHNlKTtcbiAgICAgICAgICAgICAgc2V0U3RhdHVzKHsgZGF0YSB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIG9uU3VjY2VzcyAmJiBvblN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IGdldFVzZXJFcnJvcihlKTtcbiAgICAgICAgICAgIGlmIChlcnJvci5sZW5ndGggJiYgaXNNb3VudGVkLmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgc2V0U3RhdHVzKHsgZXJyb3IgfSk7XG4gICAgICAgICAgICAgIHNldFN1Ym1pdHRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICB9XG4gICAgICB7Li4uZm9ybWlrUHJvcHN9XG4gICAgLz5cbiAgKTtcbn07XG4iXX0=