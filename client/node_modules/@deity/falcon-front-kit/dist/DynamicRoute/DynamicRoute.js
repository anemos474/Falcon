"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.DynamicRoute = void 0;

var _react = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("react"));

var _propTypes = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("prop-types"));

var _reactRouterDom = /*#__PURE__*/require("react-router-dom");

var _falconData = /*#__PURE__*/require("@deity/falcon-data");

var _Router = /*#__PURE__*/require("../Router");

var DynamicRoute = function DynamicRoute(props) {
  var components = props.components,
      NotFound = props.notFound;
  return /*#__PURE__*/_react.default.createElement(_Router.Router, null, function (router) {
    var location = props.location || router.location;
    var path = location.pathname;
    return /*#__PURE__*/_react.default.createElement(_falconData.UrlQuery, {
      variables: {
        path: path
      }
    }, function (_ref) {
      var url = _ref.data.url;

      if (!url) {
        return /*#__PURE__*/_react.default.createElement(NotFound, {
          location: location
        });
      }

      if (!('type' in url)) {
        return /*#__PURE__*/_react.default.createElement(_reactRouterDom.Redirect, {
          to: url.path
        });
      }

      var Component = components[url.type];

      if (!Component) {
        throw new Error("[DynamicRoute]: Please register component for '" + url.type + "' content type!");
      }

      return /*#__PURE__*/_react.default.createElement(Component, url);
    });
  });
};

exports.DynamicRoute = DynamicRoute;
DynamicRoute.propTypes = {
  location: _propTypes.default.any,
  components: /*#__PURE__*/_propTypes.default.objectOf( /*#__PURE__*/_propTypes.default.oneOfType([_propTypes.default.object, _propTypes.default.func]).isRequired).isRequired,
  notFound: _propTypes.default.func.isRequired
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9EeW5hbWljUm91dGUvRHluYW1pY1JvdXRlLnRzeCJdLCJuYW1lcyI6WyJEeW5hbWljUm91dGUiLCJwcm9wcyIsImNvbXBvbmVudHMiLCJOb3RGb3VuZCIsIm5vdEZvdW5kIiwicm91dGVyIiwibG9jYXRpb24iLCJwYXRoIiwicGF0aG5hbWUiLCJ1cmwiLCJkYXRhIiwiQ29tcG9uZW50IiwidHlwZSIsIkVycm9yIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwiYW55Iiwib2JqZWN0T2YiLCJvbmVPZlR5cGUiLCJvYmplY3QiLCJmdW5jIiwiaXNSZXF1aXJlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQVNPLElBQU1BLFlBQTBDLEdBQUcsU0FBN0NBLFlBQTZDLENBQUFDLEtBQUssRUFBSTtBQUNqRSxNQUFRQyxVQUFSLEdBQTJDRCxLQUEzQyxDQUFRQyxVQUFSO0FBQUEsTUFBOEJDLFFBQTlCLEdBQTJDRixLQUEzQyxDQUFvQkcsUUFBcEI7QUFFQSxzQkFDRSw2QkFBQyxjQUFELFFBQ0csVUFBQUMsTUFBTSxFQUFJO0FBQ1QsUUFBTUMsUUFBUSxHQUFHTCxLQUFLLENBQUNLLFFBQU4sSUFBa0JELE1BQU0sQ0FBQ0MsUUFBMUM7QUFDQSxRQUFrQkMsSUFBbEIsR0FBMkJELFFBQTNCLENBQVFFLFFBQVI7QUFFQSx3QkFDRSw2QkFBQyxvQkFBRDtBQUFVLE1BQUEsU0FBUyxFQUFFO0FBQUVELFFBQUFBLElBQUksRUFBSkE7QUFBRjtBQUFyQixPQUNHLGdCQUF1QjtBQUFBLFVBQVpFLEdBQVksUUFBcEJDLElBQW9CLENBQVpELEdBQVk7O0FBQ3RCLFVBQUksQ0FBQ0EsR0FBTCxFQUFVO0FBQ1IsNEJBQU8sNkJBQUMsUUFBRDtBQUFVLFVBQUEsUUFBUSxFQUFFSDtBQUFwQixVQUFQO0FBQ0Q7O0FBRUQsVUFBSSxFQUFFLFVBQVVHLEdBQVosQ0FBSixFQUFzQjtBQUNwQiw0QkFBTyw2QkFBQyx3QkFBRDtBQUFVLFVBQUEsRUFBRSxFQUFFQSxHQUFHLENBQUNGO0FBQWxCLFVBQVA7QUFDRDs7QUFFRCxVQUFNSSxTQUFTLEdBQUdULFVBQVUsQ0FBQ08sR0FBRyxDQUFDRyxJQUFMLENBQTVCOztBQUNBLFVBQUksQ0FBQ0QsU0FBTCxFQUFnQjtBQUNkLGNBQU0sSUFBSUUsS0FBSixxREFBNERKLEdBQUcsQ0FBQ0csSUFBaEUscUJBQU47QUFDRDs7QUFFRCwwQkFBTyw2QkFBQyxTQUFELEVBQWVILEdBQWYsQ0FBUDtBQUNELEtBaEJILENBREY7QUFvQkQsR0F6QkgsQ0FERjtBQTZCRCxDQWhDTTs7O0FBaUNQVCxZQUFZLENBQUNjLFNBQWIsR0FBeUI7QUFDdkJSLEVBQUFBLFFBQVEsRUFBRVMsbUJBQVVDLEdBREc7QUFFdkJkLEVBQUFBLFVBQVUsRUFBRSxnQ0FBVWUsUUFBVixDQUFtQixpQ0FBVUMsU0FBVixDQUFvQixDQUFDSCxtQkFBVUksTUFBWCxFQUFtQkosbUJBQVVLLElBQTdCLENBQXBCLEVBQXdEQyxVQUEzRSxFQUF1RkEsVUFGNUU7QUFHdkJqQixFQUFBQSxRQUFRLEVBQUVXLG1CQUFVSyxJQUFWLENBQWVDO0FBSEYsQ0FBekIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IFJlZGlyZWN0IH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyBMb2NhdGlvbiB9IGZyb20gJ2hpc3RvcnknO1xuaW1wb3J0IHsgVXJsUXVlcnksIFVybFJlc3VsdCB9IGZyb20gJ0BkZWl0eS9mYWxjb24tZGF0YSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICcuLi9Sb3V0ZXInO1xuXG5leHBvcnQgdHlwZSBEeW5hbWljUm91dGVDb21wb25lbnRQcm9wcyA9IFVybFJlc3VsdDtcbmV4cG9ydCB0eXBlIENvbXBvbmVudHNNYXAgPSBSZWNvcmQ8c3RyaW5nLCBSZWFjdC5Db21wb25lbnRUeXBlPER5bmFtaWNSb3V0ZUNvbXBvbmVudFByb3BzPiB8IG9iamVjdD47XG5leHBvcnQgdHlwZSBEeW5hbWljUm91dGVQcm9wcyA9IHtcbiAgbG9jYXRpb24/OiBMb2NhdGlvbjtcbiAgY29tcG9uZW50czogQ29tcG9uZW50c01hcDtcbiAgbm90Rm91bmQ6IFJlYWN0LkNvbXBvbmVudFR5cGU8eyBsb2NhdGlvbj86IGFueSB9Pjtcbn07XG5leHBvcnQgY29uc3QgRHluYW1pY1JvdXRlOiBSZWFjdC5TRkM8RHluYW1pY1JvdXRlUHJvcHM+ID0gcHJvcHMgPT4ge1xuICBjb25zdCB7IGNvbXBvbmVudHMsIG5vdEZvdW5kOiBOb3RGb3VuZCB9ID0gcHJvcHM7XG5cbiAgcmV0dXJuIChcbiAgICA8Um91dGVyPlxuICAgICAge3JvdXRlciA9PiB7XG4gICAgICAgIGNvbnN0IGxvY2F0aW9uID0gcHJvcHMubG9jYXRpb24gfHwgcm91dGVyLmxvY2F0aW9uO1xuICAgICAgICBjb25zdCB7IHBhdGhuYW1lOiBwYXRoIH0gPSBsb2NhdGlvbjtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxVcmxRdWVyeSB2YXJpYWJsZXM9e3sgcGF0aCB9fT5cbiAgICAgICAgICAgIHsoeyBkYXRhOiB7IHVybCB9IH0pID0+IHtcbiAgICAgICAgICAgICAgaWYgKCF1cmwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gPE5vdEZvdW5kIGxvY2F0aW9uPXtsb2NhdGlvbn0gLz47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoISgndHlwZScgaW4gdXJsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA8UmVkaXJlY3QgdG89e3VybC5wYXRofSAvPjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGNvbnN0IENvbXBvbmVudCA9IGNvbXBvbmVudHNbdXJsLnR5cGVdIGFzIFJlYWN0LkNvbXBvbmVudFR5cGU8RHluYW1pY1JvdXRlQ29tcG9uZW50UHJvcHM+O1xuICAgICAgICAgICAgICBpZiAoIUNvbXBvbmVudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgW0R5bmFtaWNSb3V0ZV06IFBsZWFzZSByZWdpc3RlciBjb21wb25lbnQgZm9yICcke3VybC50eXBlfScgY29udGVudCB0eXBlIWApO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIDxDb21wb25lbnQgey4uLnVybH0gLz47XG4gICAgICAgICAgICB9fVxuICAgICAgICAgIDwvVXJsUXVlcnk+XG4gICAgICAgICk7XG4gICAgICB9fVxuICAgIDwvUm91dGVyPlxuICApO1xufTtcbkR5bmFtaWNSb3V0ZS5wcm9wVHlwZXMgPSB7XG4gIGxvY2F0aW9uOiBQcm9wVHlwZXMuYW55LFxuICBjb21wb25lbnRzOiBQcm9wVHlwZXMub2JqZWN0T2YoUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm9iamVjdCwgUHJvcFR5cGVzLmZ1bmNdKS5pc1JlcXVpcmVkKS5pc1JlcXVpcmVkLFxuICBub3RGb3VuZDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZFxufTtcbiJdfQ==