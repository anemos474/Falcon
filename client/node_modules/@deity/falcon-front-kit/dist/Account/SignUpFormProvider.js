"use strict";

var _interopRequireDefault = /*#__PURE__*/require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.SignUpFormProvider = void 0;

var _extends2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/extends"));

var _objectWithoutPropertiesLoose2 = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _react = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("react"));

var _formik = /*#__PURE__*/require("formik");

var _falconData = /*#__PURE__*/require("@deity/falcon-data");

var _falconShopData = /*#__PURE__*/require("@deity/falcon-shop-data");

var _React = /*#__PURE__*/require("../React");

var SignUpFormProvider = function SignUpFormProvider(props) {
  var onSuccess = props.onSuccess,
      initialValues = props.initialValues,
      mutationOptions = props.mutationOptions,
      formikProps = (0, _objectWithoutPropertiesLoose2.default)(props, ["onSuccess", "initialValues", "mutationOptions"]);
  var defaultInitialValues = {
    firstname: '',
    lastname: '',
    email: '',
    password: '',
    confirmPassword: '',
    autoSignIn: true
  };

  var _useSignUpMutation = (0, _falconShopData.useSignUpMutation)(),
      signUp = _useSignUpMutation[0];

  var getUserError = (0, _falconData.useGetUserError)();
  var isMounted = (0, _React.useMounted)();
  return /*#__PURE__*/_react.default.createElement(_formik.Formik, (0, _extends2.default)({
    initialStatus: {},
    initialValues: initialValues || defaultInitialValues,
    onSubmit: function onSubmit(_ref, _ref2) {
      var setSubmitting = _ref2.setSubmitting,
          setStatus = _ref2.setStatus,
          setErrors = _ref2.setErrors;
      var confirmPassword = _ref.confirmPassword,
          signUpValues = (0, _objectWithoutPropertiesLoose2.default)(_ref, ["confirmPassword"]);
      return signUp(Object.assign({
        variables: {
          input: signUpValues
        }
      }, mutationOptions || {})).then(function (_ref3) {
        var data = _ref3.data;

        if (isMounted.current) {
          setSubmitting(false);
          setStatus({
            data: data
          });
          return onSuccess && onSuccess(data);
        }
      }).catch(function (e) {
        var error = getUserError(e);

        if (error.length && isMounted.current) {
          setErrors(error.getFieldErrors());
          setStatus({
            error: error.getFormErrors()
          });
          setSubmitting(false);
        }
      });
    }
  }, formikProps));
};

exports.SignUpFormProvider = SignUpFormProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BY2NvdW50L1NpZ25VcEZvcm1Qcm92aWRlci50c3giXSwibmFtZXMiOlsiU2lnblVwRm9ybVByb3ZpZGVyIiwicHJvcHMiLCJvblN1Y2Nlc3MiLCJpbml0aWFsVmFsdWVzIiwibXV0YXRpb25PcHRpb25zIiwiZm9ybWlrUHJvcHMiLCJkZWZhdWx0SW5pdGlhbFZhbHVlcyIsImZpcnN0bmFtZSIsImxhc3RuYW1lIiwiZW1haWwiLCJwYXNzd29yZCIsImNvbmZpcm1QYXNzd29yZCIsImF1dG9TaWduSW4iLCJzaWduVXAiLCJnZXRVc2VyRXJyb3IiLCJpc01vdW50ZWQiLCJzZXRTdWJtaXR0aW5nIiwic2V0U3RhdHVzIiwic2V0RXJyb3JzIiwic2lnblVwVmFsdWVzIiwidmFyaWFibGVzIiwiaW5wdXQiLCJ0aGVuIiwiZGF0YSIsImN1cnJlbnQiLCJjYXRjaCIsImUiLCJlcnJvciIsImxlbmd0aCIsImdldEZpZWxkRXJyb3JzIiwiZ2V0Rm9ybUVycm9ycyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFXTyxJQUFNQSxrQkFBc0QsR0FBRyxTQUF6REEsa0JBQXlELENBQUFDLEtBQUssRUFBSTtBQUM3RSxNQUFRQyxTQUFSLEdBQXNFRCxLQUF0RSxDQUFRQyxTQUFSO0FBQUEsTUFBbUJDLGFBQW5CLEdBQXNFRixLQUF0RSxDQUFtQkUsYUFBbkI7QUFBQSxNQUFrQ0MsZUFBbEMsR0FBc0VILEtBQXRFLENBQWtDRyxlQUFsQztBQUFBLE1BQXNEQyxXQUF0RCwrQ0FBc0VKLEtBQXRFO0FBQ0EsTUFBTUssb0JBQXNDLEdBQUc7QUFDN0NDLElBQUFBLFNBQVMsRUFBRSxFQURrQztBQUU3Q0MsSUFBQUEsUUFBUSxFQUFFLEVBRm1DO0FBRzdDQyxJQUFBQSxLQUFLLEVBQUUsRUFIc0M7QUFJN0NDLElBQUFBLFFBQVEsRUFBRSxFQUptQztBQUs3Q0MsSUFBQUEsZUFBZSxFQUFFLEVBTDRCO0FBTTdDQyxJQUFBQSxVQUFVLEVBQUU7QUFOaUMsR0FBL0M7O0FBU0EsMkJBQWlCLHdDQUFqQjtBQUFBLE1BQU9DLE1BQVA7O0FBQ0EsTUFBTUMsWUFBWSxHQUFHLGtDQUFyQjtBQUNBLE1BQU1DLFNBQVMsR0FBRyx3QkFBbEI7QUFFQSxzQkFDRSw2QkFBQyxjQUFEO0FBQ0UsSUFBQSxhQUFhLEVBQUUsRUFEakI7QUFFRSxJQUFBLGFBQWEsRUFBRVosYUFBYSxJQUFJRyxvQkFGbEM7QUFHRSxJQUFBLFFBQVEsRUFBRTtBQUFBLFVBQXlDVSxhQUF6QyxTQUF5Q0EsYUFBekM7QUFBQSxVQUF3REMsU0FBeEQsU0FBd0RBLFNBQXhEO0FBQUEsVUFBbUVDLFNBQW5FLFNBQW1FQSxTQUFuRTtBQUFBLFVBQUdQLGVBQUgsUUFBR0EsZUFBSDtBQUFBLFVBQXVCUSxZQUF2QjtBQUFBLGFBQ1JOLE1BQU07QUFBR08sUUFBQUEsU0FBUyxFQUFFO0FBQUVDLFVBQUFBLEtBQUssRUFBRUY7QUFBVDtBQUFkLFNBQTJDZixlQUFlLElBQUksRUFBOUQsRUFBTixDQUNHa0IsSUFESCxDQUNRLGlCQUFjO0FBQUEsWUFBWEMsSUFBVyxTQUFYQSxJQUFXOztBQUNsQixZQUFJUixTQUFTLENBQUNTLE9BQWQsRUFBdUI7QUFDckJSLFVBQUFBLGFBQWEsQ0FBQyxLQUFELENBQWI7QUFDQUMsVUFBQUEsU0FBUyxDQUFDO0FBQUVNLFlBQUFBLElBQUksRUFBSkE7QUFBRixXQUFELENBQVQ7QUFDQSxpQkFBT3JCLFNBQVMsSUFBSUEsU0FBUyxDQUFDcUIsSUFBRCxDQUE3QjtBQUNEO0FBQ0YsT0FQSCxFQVFHRSxLQVJILENBUVMsVUFBQUMsQ0FBQyxFQUFJO0FBQ1YsWUFBTUMsS0FBSyxHQUFHYixZQUFZLENBQUNZLENBQUQsQ0FBMUI7O0FBQ0EsWUFBSUMsS0FBSyxDQUFDQyxNQUFOLElBQWdCYixTQUFTLENBQUNTLE9BQTlCLEVBQXVDO0FBQ3JDTixVQUFBQSxTQUFTLENBQUNTLEtBQUssQ0FBQ0UsY0FBTixFQUFELENBQVQ7QUFDQVosVUFBQUEsU0FBUyxDQUFDO0FBQUVVLFlBQUFBLEtBQUssRUFBRUEsS0FBSyxDQUFDRyxhQUFOO0FBQVQsV0FBRCxDQUFUO0FBRUFkLFVBQUFBLGFBQWEsQ0FBQyxLQUFELENBQWI7QUFDRDtBQUNGLE9BaEJILENBRFE7QUFBQTtBQUhaLEtBc0JNWCxXQXRCTixFQURGO0FBMEJELENBekNNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEZvcm1payB9IGZyb20gJ2Zvcm1payc7XG5pbXBvcnQgeyB1c2VHZXRVc2VyRXJyb3IgfSBmcm9tICdAZGVpdHkvZmFsY29uLWRhdGEnO1xuaW1wb3J0IHsgdXNlU2lnblVwTXV0YXRpb24sIFNpZ25VcFJlc3BvbnNlIH0gZnJvbSAnQGRlaXR5L2ZhbGNvbi1zaG9wLWRhdGEnO1xuaW1wb3J0IHsgRm9ybVByb3ZpZGVyUHJvcHMgfSBmcm9tICcuLi9Gb3Jtcyc7XG5pbXBvcnQgeyB1c2VNb3VudGVkIH0gZnJvbSAnLi4vUmVhY3QnO1xuXG5leHBvcnQgdHlwZSBTaWduVXBGb3JtVmFsdWVzID0ge1xuICBmaXJzdG5hbWU6IHN0cmluZztcbiAgbGFzdG5hbWU6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgY29uZmlybVBhc3N3b3JkOiBzdHJpbmc7XG4gIGF1dG9TaWduSW46IGJvb2xlYW47XG59O1xuZXhwb3J0IHR5cGUgU2lnblVwRm9ybVByb3ZpZGVyUHJvcHMgPSBGb3JtUHJvdmlkZXJQcm9wczxTaWduVXBGb3JtVmFsdWVzLCBTaWduVXBSZXNwb25zZT47XG5leHBvcnQgY29uc3QgU2lnblVwRm9ybVByb3ZpZGVyOiBSZWFjdC5TRkM8U2lnblVwRm9ybVByb3ZpZGVyUHJvcHM+ID0gcHJvcHMgPT4ge1xuICBjb25zdCB7IG9uU3VjY2VzcywgaW5pdGlhbFZhbHVlcywgbXV0YXRpb25PcHRpb25zLCAuLi5mb3JtaWtQcm9wcyB9ID0gcHJvcHM7XG4gIGNvbnN0IGRlZmF1bHRJbml0aWFsVmFsdWVzOiBTaWduVXBGb3JtVmFsdWVzID0ge1xuICAgIGZpcnN0bmFtZTogJycsXG4gICAgbGFzdG5hbWU6ICcnLFxuICAgIGVtYWlsOiAnJyxcbiAgICBwYXNzd29yZDogJycsXG4gICAgY29uZmlybVBhc3N3b3JkOiAnJyxcbiAgICBhdXRvU2lnbkluOiB0cnVlXG4gIH07XG5cbiAgY29uc3QgW3NpZ25VcF0gPSB1c2VTaWduVXBNdXRhdGlvbigpO1xuICBjb25zdCBnZXRVc2VyRXJyb3IgPSB1c2VHZXRVc2VyRXJyb3IoKTtcbiAgY29uc3QgaXNNb3VudGVkID0gdXNlTW91bnRlZCgpO1xuXG4gIHJldHVybiAoXG4gICAgPEZvcm1pa1xuICAgICAgaW5pdGlhbFN0YXR1cz17e319XG4gICAgICBpbml0aWFsVmFsdWVzPXtpbml0aWFsVmFsdWVzIHx8IGRlZmF1bHRJbml0aWFsVmFsdWVzfVxuICAgICAgb25TdWJtaXQ9eyh7IGNvbmZpcm1QYXNzd29yZCwgLi4uc2lnblVwVmFsdWVzIH0sIHsgc2V0U3VibWl0dGluZywgc2V0U3RhdHVzLCBzZXRFcnJvcnMgfSkgPT5cbiAgICAgICAgc2lnblVwKHsgdmFyaWFibGVzOiB7IGlucHV0OiBzaWduVXBWYWx1ZXMgfSwgLi4uKG11dGF0aW9uT3B0aW9ucyB8fCB7fSkgfSlcbiAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHtcbiAgICAgICAgICAgIGlmIChpc01vdW50ZWQuY3VycmVudCkge1xuICAgICAgICAgICAgICBzZXRTdWJtaXR0aW5nKGZhbHNlKTtcbiAgICAgICAgICAgICAgc2V0U3RhdHVzKHsgZGF0YSB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIG9uU3VjY2VzcyAmJiBvblN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IGdldFVzZXJFcnJvcihlKTtcbiAgICAgICAgICAgIGlmIChlcnJvci5sZW5ndGggJiYgaXNNb3VudGVkLmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgc2V0RXJyb3JzKGVycm9yLmdldEZpZWxkRXJyb3JzKCkpO1xuICAgICAgICAgICAgICBzZXRTdGF0dXMoeyBlcnJvcjogZXJyb3IuZ2V0Rm9ybUVycm9ycygpIH0pO1xuXG4gICAgICAgICAgICAgIHNldFN1Ym1pdHRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICB9XG4gICAgICB7Li4uZm9ybWlrUHJvcHN9XG4gICAgLz5cbiAgKTtcbn07XG4iXX0=