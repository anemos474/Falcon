"use strict";

exports.__esModule = true;
exports.setFalconScopeToCookie = exports.getFalconScopeFromCookie = exports.FALCON_SCOPE_COOKIE_NAME = void 0;
var FALCON_SCOPE_COOKIE_NAME = 'falcon-scope';
/**
 * provide FalconClient side Scope configuration from cookie
 * @param config
 * @param context
 */

exports.FALCON_SCOPE_COOKIE_NAME = FALCON_SCOPE_COOKIE_NAME;

var getFalconScopeFromCookie = function getFalconScopeFromCookie(config, context) {
  var scopes = config.scopes,
      defaultId = config.defaultId;
  var cookies = context.cookies;
  var falconScopeId = cookies.get(FALCON_SCOPE_COOKIE_NAME);
  var id = falconScopeId || defaultId;
  return {
    id: scopes.find(function (x) {
      return x.id === id;
    }).id
  };
};

exports.getFalconScopeFromCookie = getFalconScopeFromCookie;

var setFalconScopeToCookie = function setFalconScopeToCookie(falconScopeId, config, context) {
  var defaultId = config.defaultId;
  var cookies = context.cookies;

  if (falconScopeId === defaultId) {
    cookies.remove(FALCON_SCOPE_COOKIE_NAME);
  } else {
    cookies.set(FALCON_SCOPE_COOKIE_NAME, falconScopeId);
  }

  if (typeof window !== 'undefined') {
    setTimeout(function () {
      return window.location.reload();
    }, 1);
  }

  return {
    id: falconScopeId
  };
};

exports.setFalconScopeToCookie = setFalconScopeToCookie;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9GYWxjb25TY29wZS9mYWxjb25TY29wZUZyb21Db29raWUudHMiXSwibmFtZXMiOlsiRkFMQ09OX1NDT1BFX0NPT0tJRV9OQU1FIiwiZ2V0RmFsY29uU2NvcGVGcm9tQ29va2llIiwiY29uZmlnIiwiY29udGV4dCIsInNjb3BlcyIsImRlZmF1bHRJZCIsImNvb2tpZXMiLCJmYWxjb25TY29wZUlkIiwiZ2V0IiwiaWQiLCJmaW5kIiwieCIsInNldEZhbGNvblNjb3BlVG9Db29raWUiLCJyZW1vdmUiLCJzZXQiLCJ3aW5kb3ciLCJzZXRUaW1lb3V0IiwibG9jYXRpb24iLCJyZWxvYWQiXSwibWFwcGluZ3MiOiI7Ozs7QUFFTyxJQUFNQSx3QkFBd0IsR0FBRyxjQUFqQztBQUVQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFDTyxJQUFNQyx3QkFBb0QsR0FBRyxTQUF2REEsd0JBQXVELENBQUNDLE1BQUQsRUFBU0MsT0FBVCxFQUFxQjtBQUN2RixNQUFRQyxNQUFSLEdBQThCRixNQUE5QixDQUFRRSxNQUFSO0FBQUEsTUFBZ0JDLFNBQWhCLEdBQThCSCxNQUE5QixDQUFnQkcsU0FBaEI7QUFDQSxNQUFRQyxPQUFSLEdBQW9CSCxPQUFwQixDQUFRRyxPQUFSO0FBRUEsTUFBTUMsYUFBYSxHQUFHRCxPQUFPLENBQUNFLEdBQVIsQ0FBWVIsd0JBQVosQ0FBdEI7QUFDQSxNQUFNUyxFQUFFLEdBQUdGLGFBQWEsSUFBSUYsU0FBNUI7QUFFQSxTQUFPO0FBQ0xJLElBQUFBLEVBQUUsRUFBRUwsTUFBTSxDQUFDTSxJQUFQLENBQVksVUFBQUMsQ0FBQztBQUFBLGFBQUlBLENBQUMsQ0FBQ0YsRUFBRixLQUFTQSxFQUFiO0FBQUEsS0FBYixFQUE4QkE7QUFEN0IsR0FBUDtBQUdELENBVk07Ozs7QUFZQSxJQUFNRyxzQkFBa0QsR0FBRyxTQUFyREEsc0JBQXFELENBQUNMLGFBQUQsRUFBZ0JMLE1BQWhCLEVBQXdCQyxPQUF4QixFQUFvQztBQUNwRyxNQUFRRSxTQUFSLEdBQXNCSCxNQUF0QixDQUFRRyxTQUFSO0FBQ0EsTUFBUUMsT0FBUixHQUFvQkgsT0FBcEIsQ0FBUUcsT0FBUjs7QUFFQSxNQUFJQyxhQUFhLEtBQUtGLFNBQXRCLEVBQWlDO0FBQy9CQyxJQUFBQSxPQUFPLENBQUNPLE1BQVIsQ0FBZWIsd0JBQWY7QUFDRCxHQUZELE1BRU87QUFDTE0sSUFBQUEsT0FBTyxDQUFDUSxHQUFSLENBQVlkLHdCQUFaLEVBQXNDTyxhQUF0QztBQUNEOztBQUVELE1BQUksT0FBT1EsTUFBUCxLQUFrQixXQUF0QixFQUFtQztBQUNqQ0MsSUFBQUEsVUFBVSxDQUFDO0FBQUEsYUFBTUQsTUFBTSxDQUFDRSxRQUFQLENBQWdCQyxNQUFoQixFQUFOO0FBQUEsS0FBRCxFQUFpQyxDQUFqQyxDQUFWO0FBQ0Q7O0FBRUQsU0FBTztBQUNMVCxJQUFBQSxFQUFFLEVBQUVGO0FBREMsR0FBUDtBQUdELENBakJNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR2V0RmFsY29uQ2xpZW50U2NvcGVDb25maWcsIFNldEZhbGNvbkNsaWVudFNjb3BlQ29uZmlnIH0gZnJvbSAnLi9GYWxjb25DbGllbnRTY29wZUNvbmZpZyc7XG5cbmV4cG9ydCBjb25zdCBGQUxDT05fU0NPUEVfQ09PS0lFX05BTUUgPSAnZmFsY29uLXNjb3BlJztcblxuLyoqXG4gKiBwcm92aWRlIEZhbGNvbkNsaWVudCBzaWRlIFNjb3BlIGNvbmZpZ3VyYXRpb24gZnJvbSBjb29raWVcbiAqIEBwYXJhbSBjb25maWdcbiAqIEBwYXJhbSBjb250ZXh0XG4gKi9cbmV4cG9ydCBjb25zdCBnZXRGYWxjb25TY29wZUZyb21Db29raWU6IEdldEZhbGNvbkNsaWVudFNjb3BlQ29uZmlnID0gKGNvbmZpZywgY29udGV4dCkgPT4ge1xuICBjb25zdCB7IHNjb3BlcywgZGVmYXVsdElkIH0gPSBjb25maWc7XG4gIGNvbnN0IHsgY29va2llcyB9ID0gY29udGV4dDtcblxuICBjb25zdCBmYWxjb25TY29wZUlkID0gY29va2llcy5nZXQoRkFMQ09OX1NDT1BFX0NPT0tJRV9OQU1FKTtcbiAgY29uc3QgaWQgPSBmYWxjb25TY29wZUlkIHx8IGRlZmF1bHRJZDtcblxuICByZXR1cm4ge1xuICAgIGlkOiBzY29wZXMuZmluZCh4ID0+IHguaWQgPT09IGlkKS5pZFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IHNldEZhbGNvblNjb3BlVG9Db29raWU6IFNldEZhbGNvbkNsaWVudFNjb3BlQ29uZmlnID0gKGZhbGNvblNjb3BlSWQsIGNvbmZpZywgY29udGV4dCkgPT4ge1xuICBjb25zdCB7IGRlZmF1bHRJZCB9ID0gY29uZmlnO1xuICBjb25zdCB7IGNvb2tpZXMgfSA9IGNvbnRleHQ7XG5cbiAgaWYgKGZhbGNvblNjb3BlSWQgPT09IGRlZmF1bHRJZCkge1xuICAgIGNvb2tpZXMucmVtb3ZlKEZBTENPTl9TQ09QRV9DT09LSUVfTkFNRSk7XG4gIH0gZWxzZSB7XG4gICAgY29va2llcy5zZXQoRkFMQ09OX1NDT1BFX0NPT0tJRV9OQU1FLCBmYWxjb25TY29wZUlkKTtcbiAgfVxuXG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHNldFRpbWVvdXQoKCkgPT4gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpLCAxKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaWQ6IGZhbGNvblNjb3BlSWRcbiAgfTtcbn07XG4iXX0=