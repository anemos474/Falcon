import _extends from "@babel/runtime/helpers/esm/extends";
import _objectWithoutPropertiesLoose from "@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";
import _inheritsLoose from "@babel/runtime/helpers/esm/inheritsLoose";
import React from 'react';
import { themed, extractThemableProps } from '../theme';
import { Box } from './Box';
import { Icon } from './Icon'; // based on https://github.com/facebook/react/issues/10135#issuecomment-314441175

function triggerChange(element, value) {
  var valueSetter = Object.getOwnPropertyDescriptor(element, 'value').set;
  var prototype = Object.getPrototypeOf(element);
  var prototypeValueSetter = Object.getOwnPropertyDescriptor(prototype, 'value').set;

  if (valueSetter && prototypeValueSetter && valueSetter !== prototypeValueSetter) {
    prototypeValueSetter.call(element, value);
  } else if (valueSetter) {
    valueSetter.call(element, value);
  }

  element.dispatchEvent(new Event('change', {
    bubbles: true
  }));
}

var NumberInputInnerDOM = /*#__PURE__*/function (_React$Component) {
  _inheritsLoose(NumberInputInnerDOM, _React$Component);

  function NumberInputInnerDOM() {
    var _this;

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;
    _this.inputRef = void 0;

    _this.onChange = function (e) {
      _this.setState({});

      if (_this.props.onChange) {
        _this.props.onChange(e);
      }
    };

    _this.mountInputRef = function (el) {
      _this.inputRef = el;

      _this.setState({});
    };

    _this.stepUp = function () {
      if (!_this.inputRef) {
        return;
      }

      var currentValue = +_this.inputRef.value;
      var nextValue = currentValue + _this.props.step;

      if (nextValue > _this.props.max) {
        nextValue = _this.props.max;
      }

      triggerChange(_this.inputRef, nextValue);
    };

    _this.stepDown = function () {
      if (!_this.inputRef) {
        return;
      }

      var currentValue = +_this.inputRef.value;
      var nextValue = currentValue - _this.props.step;

      if (nextValue < _this.props.min) {
        nextValue = _this.props.min;
      }

      triggerChange(_this.inputRef, nextValue);
    };

    return _this;
  }

  var _proto = NumberInputInnerDOM.prototype;

  _proto.canIncrease = function canIncrease() {
    if (!this.inputRef) {
      return false;
    }

    var currentValue = +this.inputRef.value;
    return currentValue < this.props.max;
  };

  _proto.canDecrease = function canDecrease() {
    if (!this.inputRef) {
      return false;
    }

    var currentValue = +this.inputRef.value;
    return currentValue > this.props.min;
  };

  _proto.render = function render() {
    var _this$props = this.props,
        className = _this$props.className,
        invalid = _this$props.invalid,
        disabled = _this$props.disabled,
        value = _this$props.value,
        min = _this$props.min,
        max = _this$props.max,
        decreaseText = _this$props.decreaseText,
        increaseText = _this$props.increaseText,
        remaining = _objectWithoutPropertiesLoose(_this$props, ["className", "invalid", "disabled", "value", "min", "max", "decreaseText", "increaseText"]);

    var _extractThemableProps = extractThemableProps(remaining),
        themableProps = _extractThemableProps.themableProps,
        rest = _extractThemableProps.rest;

    return /*#__PURE__*/React.createElement(Box, _extends({}, themableProps, {
      className: className
    }), /*#__PURE__*/React.createElement("button", {
      type: "button",
      onClick: this.stepDown,
      "aria-label": decreaseText,
      className: "-inner-input-step-down-element",
      disabled: disabled || !this.canDecrease()
    }, /*#__PURE__*/React.createElement(Icon, {
      src: "numberInputDown",
      fallback: "\u2212"
    })), /*#__PURE__*/React.createElement("input", _extends({
      ref: this.mountInputRef,
      disabled: disabled,
      min: min,
      max: max,
      value: value,
      type: "number",
      onChange: this.onChange
    }, rest)), /*#__PURE__*/React.createElement("button", {
      type: "button",
      onClick: this.stepUp,
      "aria-label": increaseText,
      className: "-inner-input-step-up-element",
      disabled: disabled || !this.canIncrease()
    }, /*#__PURE__*/React.createElement(Icon, {
      src: "numberInputUp",
      fallback: "+"
    })));
  };

  return NumberInputInnerDOM;
}(React.Component);

export var NumberInput = /*#__PURE__*/themed({
  tag: NumberInputInnerDOM,
  defaultProps: {
    invalid: false,
    min: Number.NEGATIVE_INFINITY,
    max: Number.POSITIVE_INFINITY,
    step: 1,
    increaseText: 'Increase Quantity',
    decreaseText: 'Decrease Quantity'
  },
  defaultTheme: {
    numberInput: {
      display: 'inline-flex',
      alignItems: 'center',
      height: 'lg',
      css: function css(_ref) {
        var theme = _ref.theme,
            invalid = _ref.invalid;
        return {
          input: {
            flex: 'none',
            width: theme.spacing.lg,
            height: '100%',
            appearance: 'none',
            MozAppearance: 'textfield',
            fontStyle: 'inherit',
            textAlign: 'center',
            border: theme.borders.regular,
            borderRadius: theme.borderRadius.medium,
            borderColor: invalid ? theme.colors.error : theme.colors.secondaryDark,
            boxShadow: 'none',
            '::-webkit-outer-spin-button,::-webkit-inner-spin-button': {
              appearance: 'none'
            },
            ':focus': {
              outline: 'none',
              borderColor: invalid ? theme.colors.error : theme.colors.secondary
            }
          },
          '.-inner-input-step-down-element, .-inner-input-step-up-element': {
            height: '100%',
            flex: 'none',
            width: theme.spacing.lg,
            border: 'none',
            outline: 'none',
            appearance: 'none',
            transitionProperty: 'transform, background',
            transitionTimingFunction: theme.easingFunctions.easeIn,
            transitionDuration: theme.transitionDurations.short,
            background: theme.colors.secondaryDark,
            color: theme.colors.secondaryText,
            borderRadius: theme.borderRadius.round,
            fontWeight: theme.fontWeights.bold,
            fontSize: 'inherit',
            cursor: 'pointer',
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
            transform: 'scale(0.8)',
            lineHeight: 1,
            ':hover': {
              background: theme.colors.secondary
            },
            ':disabled': {
              opacity: '0.5'
            }
          },
          '.-inner-input-step-down-element': {
            marginRight: theme.spacing.xs,
            ':active': {
              transform: 'scale(0.6)'
            }
          },
          '.-inner-input-step-up-element': {
            marginLeft: theme.spacing.xs,
            ':active': {
              transform: 'scale(1)'
            }
          }
        };
      }
    }
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL051bWJlcklucHV0LnRzeCJdLCJuYW1lcyI6WyJSZWFjdCIsInRoZW1lZCIsImV4dHJhY3RUaGVtYWJsZVByb3BzIiwiQm94IiwiSWNvbiIsInRyaWdnZXJDaGFuZ2UiLCJlbGVtZW50IiwidmFsdWUiLCJ2YWx1ZVNldHRlciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInNldCIsInByb3RvdHlwZSIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlVmFsdWVTZXR0ZXIiLCJjYWxsIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiYnViYmxlcyIsIk51bWJlcklucHV0SW5uZXJET00iLCJpbnB1dFJlZiIsIm9uQ2hhbmdlIiwiZSIsInNldFN0YXRlIiwicHJvcHMiLCJtb3VudElucHV0UmVmIiwiZWwiLCJzdGVwVXAiLCJjdXJyZW50VmFsdWUiLCJuZXh0VmFsdWUiLCJzdGVwIiwibWF4Iiwic3RlcERvd24iLCJtaW4iLCJjYW5JbmNyZWFzZSIsImNhbkRlY3JlYXNlIiwicmVuZGVyIiwiY2xhc3NOYW1lIiwiaW52YWxpZCIsImRpc2FibGVkIiwiZGVjcmVhc2VUZXh0IiwiaW5jcmVhc2VUZXh0IiwicmVtYWluaW5nIiwidGhlbWFibGVQcm9wcyIsInJlc3QiLCJDb21wb25lbnQiLCJOdW1iZXJJbnB1dCIsInRhZyIsImRlZmF1bHRQcm9wcyIsIk51bWJlciIsIk5FR0FUSVZFX0lORklOSVRZIiwiUE9TSVRJVkVfSU5GSU5JVFkiLCJkZWZhdWx0VGhlbWUiLCJudW1iZXJJbnB1dCIsImRpc3BsYXkiLCJhbGlnbkl0ZW1zIiwiaGVpZ2h0IiwiY3NzIiwidGhlbWUiLCJpbnB1dCIsImZsZXgiLCJ3aWR0aCIsInNwYWNpbmciLCJsZyIsImFwcGVhcmFuY2UiLCJNb3pBcHBlYXJhbmNlIiwiZm9udFN0eWxlIiwidGV4dEFsaWduIiwiYm9yZGVyIiwiYm9yZGVycyIsInJlZ3VsYXIiLCJib3JkZXJSYWRpdXMiLCJtZWRpdW0iLCJib3JkZXJDb2xvciIsImNvbG9ycyIsImVycm9yIiwic2Vjb25kYXJ5RGFyayIsImJveFNoYWRvdyIsIm91dGxpbmUiLCJzZWNvbmRhcnkiLCJ0cmFuc2l0aW9uUHJvcGVydHkiLCJ0cmFuc2l0aW9uVGltaW5nRnVuY3Rpb24iLCJlYXNpbmdGdW5jdGlvbnMiLCJlYXNlSW4iLCJ0cmFuc2l0aW9uRHVyYXRpb24iLCJ0cmFuc2l0aW9uRHVyYXRpb25zIiwic2hvcnQiLCJiYWNrZ3JvdW5kIiwiY29sb3IiLCJzZWNvbmRhcnlUZXh0Iiwicm91bmQiLCJmb250V2VpZ2h0IiwiZm9udFdlaWdodHMiLCJib2xkIiwiZm9udFNpemUiLCJjdXJzb3IiLCJqdXN0aWZ5Q29udGVudCIsInRyYW5zZm9ybSIsImxpbmVIZWlnaHQiLCJvcGFjaXR5IiwibWFyZ2luUmlnaHQiLCJ4cyIsIm1hcmdpbkxlZnQiXSwibWFwcGluZ3MiOiI7OztBQUFBLE9BQU9BLEtBQVAsTUFBdUUsT0FBdkU7QUFDQSxTQUFTQyxNQUFULEVBQWlCQyxvQkFBakIsUUFBNkMsVUFBN0M7QUFDQSxTQUFTQyxHQUFULFFBQW9CLE9BQXBCO0FBQ0EsU0FBU0MsSUFBVCxRQUFxQixRQUFyQixDLENBRUE7O0FBQ0EsU0FBU0MsYUFBVCxDQUF1QkMsT0FBdkIsRUFBcUNDLEtBQXJDLEVBQWlEO0FBQy9DLE1BQU1DLFdBQVcsR0FBR0MsTUFBTSxDQUFDQyx3QkFBUCxDQUFnQ0osT0FBaEMsRUFBeUMsT0FBekMsRUFBbURLLEdBQXZFO0FBQ0EsTUFBTUMsU0FBUyxHQUFHSCxNQUFNLENBQUNJLGNBQVAsQ0FBc0JQLE9BQXRCLENBQWxCO0FBQ0EsTUFBTVEsb0JBQW9CLEdBQUdMLE1BQU0sQ0FBQ0Msd0JBQVAsQ0FBZ0NFLFNBQWhDLEVBQTJDLE9BQTNDLEVBQXFERCxHQUFsRjs7QUFFQSxNQUFJSCxXQUFXLElBQUlNLG9CQUFmLElBQXVDTixXQUFXLEtBQUtNLG9CQUEzRCxFQUFpRjtBQUMvRUEsSUFBQUEsb0JBQW9CLENBQUND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ZHNEO0FBZWhFQyxZQUFBQSxNQUFNLEVBQUUsU0Fmd0Q7QUFnQmhFekMsWUFBQUEsT0FBTyxFQUFFLE1BaEJ1RDtBQWlCaEUwQyxZQUFBQSxjQUFjLEVBQUUsUUFqQmdEO0FBa0JoRXpDLFlBQUFBLFVBQVUsRUFBRSxRQWxCb0Q7QUFtQmhFMEMsWUFBQUEsU0FBUyxFQUFFLFlBbkJxRDtBQW9CaEVDLFlBQUFBLFVBQVUsRUFBRSxDQXBCb0Q7QUFxQmhFLHNCQUFVO0FBQ1JYLGNBQUFBLFVBQVUsRUFBRTdCLEtBQUssQ0FBQ2dCLE1BQU4sQ0FBYUs7QUFEakIsYUFyQnNEO0FBd0JoRSx5QkFBYTtBQUNYb0IsY0FBQUEsT0FBTyxFQUFFO0FBREU7QUF4Qm1ELFdBdEJ0QztBQWtENUIsNkNBQW1DO0FBQ2pDQyxZQUFBQSxXQUFXLEVBQUUxQyxLQUFLLENBQUNJLE9BQU4sQ0FBY3VDLEVBRE07QUFFakMsdUJBQVc7QUFDVEosY0FBQUEsU0FBUyxFQUFFO0FBREY7QUFGc0IsV0FsRFA7QUF3RDVCLDJDQUFpQztBQUMvQkssWUFBQUEsVUFBVSxFQUFFNUMsS0FBSyxDQUFDSSxPQUFOLENBQWN1QyxFQURLO0FBRS9CLHVCQUFXO0FBQ1RKLGNBQUFBLFNBQVMsRUFBRTtBQURGO0FBRm9CO0FBeERMLFNBQXpCO0FBQUE7QUFMTTtBQUREO0FBWmtCLENBQUQsQ0FBMUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIEZDLCB1c2VTdGF0ZSwgdXNlRWZmZWN0LCBjcmVhdGVSZWYgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB0aGVtZWQsIGV4dHJhY3RUaGVtYWJsZVByb3BzIH0gZnJvbSAnLi4vdGhlbWUnO1xuaW1wb3J0IHsgQm94IH0gZnJvbSAnLi9Cb3gnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4vSWNvbic7XG5cbi8vIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9pc3N1ZXMvMTAxMzUjaXNzdWVjb21tZW50LTMxNDQ0MTE3NVxuZnVuY3Rpb24gdHJpZ2dlckNoYW5nZShlbGVtZW50OiBhbnksIHZhbHVlOiBhbnkpIHtcbiAgY29uc3QgdmFsdWVTZXR0ZXIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGVsZW1lbnQsICd2YWx1ZScpIS5zZXQ7XG4gIGNvbnN0IHByb3RvdHlwZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihlbGVtZW50KTtcbiAgY29uc3QgcHJvdG90eXBlVmFsdWVTZXR0ZXIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvdHlwZSwgJ3ZhbHVlJykhLnNldDtcblxuICBpZiAodmFsdWVTZXR0ZXIgJiYgcHJvdG90eXBlVmFsdWVTZXR0ZXIgJiYgdmFsdWVTZXR0ZXIgIT09IHByb3RvdHlwZVZhbHVlU2V0dGVyKSB7XG4gICAgcHJvdG90eXBlVmFsdWVTZXR0ZXIuY2FsbChlbGVtZW50LCB2YWx1ZSk7XG4gIH0gZWxzZSBpZiAodmFsdWVTZXR0ZXIpIHtcbiAgICB2YWx1ZVNldHRlci5jYWxsKGVsZW1lbnQsIHZhbHVlKTtcbiAgfVxuXG4gIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScsIHsgYnViYmxlczogdHJ1ZSB9KSk7XG59XG5cbnR5cGUgTnVtYmVySW5wdXRJbm5lckRPTVByb3BzID0ge1xuICBpbnZhbGlkPzogYm9vbGVhbjtcbiAgaW5jcmVhc2VUZXh0Pzogc3RyaW5nO1xuICBkZWNyZWFzZVRleHQ/OiBzdHJpbmc7XG4gIHN0ZXA/OiBudW1iZXI7XG4gIG1pbj86IG51bWJlcjtcbiAgbWF4PzogbnVtYmVyO1xufSAmIFJlYWN0LkRldGFpbGVkSFRNTFByb3BzPFJlYWN0LklucHV0SFRNTEF0dHJpYnV0ZXM8SFRNTElucHV0RWxlbWVudD4sIEhUTUxJbnB1dEVsZW1lbnQ+O1xuXG5jbGFzcyBOdW1iZXJJbnB1dElubmVyRE9NIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PE51bWJlcklucHV0SW5uZXJET01Qcm9wcz4ge1xuICBpbnB1dFJlZjogSFRNTElucHV0RWxlbWVudCB8IHVuZGVmaW5lZDtcblxuICBvbkNoYW5nZSA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoe30pO1xuICAgIGlmICh0aGlzLnByb3BzLm9uQ2hhbmdlKSB7XG4gICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKGUpO1xuICAgIH1cbiAgfTtcblxuICBtb3VudElucHV0UmVmID0gKGVsOiBIVE1MSW5wdXRFbGVtZW50KSA9PiB7XG4gICAgdGhpcy5pbnB1dFJlZiA9IGVsO1xuICAgIHRoaXMuc2V0U3RhdGUoe30pO1xuICB9O1xuXG4gIHN0ZXBVcCA9ICgpID0+IHtcbiAgICBpZiAoIXRoaXMuaW5wdXRSZWYpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50VmFsdWUgPSArdGhpcy5pbnB1dFJlZi52YWx1ZTtcblxuICAgIGxldCBuZXh0VmFsdWUgPSBjdXJyZW50VmFsdWUgKyB0aGlzLnByb3BzLnN0ZXA7XG4gICAgaWYgKG5leHRWYWx1ZSA+IHRoaXMucHJvcHMubWF4KSB7XG4gICAgICBuZXh0VmFsdWUgPSB0aGlzLnByb3BzLm1heDtcbiAgICB9XG5cbiAgICB0cmlnZ2VyQ2hhbmdlKHRoaXMuaW5wdXRSZWYsIG5leHRWYWx1ZSk7XG4gIH07XG5cbiAgc3RlcERvd24gPSAoKSA9PiB7XG4gICAgaWYgKCF0aGlzLmlucHV0UmVmKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gK3RoaXMuaW5wdXRSZWYudmFsdWU7XG5cbiAgICBsZXQgbmV4dFZhbHVlID0gY3VycmVudFZhbHVlIC0gdGhpcy5wcm9wcy5zdGVwO1xuICAgIGlmIChuZXh0VmFsdWUgPCB0aGlzLnByb3BzLm1pbikge1xuICAgICAgbmV4dFZhbHVlID0gdGhpcy5wcm9wcy5taW47XG4gICAgfVxuXG4gICAgdHJpZ2dlckNoYW5nZSh0aGlzLmlucHV0UmVmLCBuZXh0VmFsdWUpO1xuICB9O1xuXG4gIGNhbkluY3JlYXNlKCkge1xuICAgIGlmICghdGhpcy5pbnB1dFJlZikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9ICt0aGlzLmlucHV0UmVmLnZhbHVlO1xuICAgIHJldHVybiBjdXJyZW50VmFsdWUgPCB0aGlzLnByb3BzLm1heDtcbiAgfVxuXG4gIGNhbkRlY3JlYXNlKCkge1xuICAgIGlmICghdGhpcy5pbnB1dFJlZikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9ICt0aGlzLmlucHV0UmVmLnZhbHVlO1xuICAgIHJldHVybiBjdXJyZW50VmFsdWUgPiB0aGlzLnByb3BzLm1pbjtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGNsYXNzTmFtZSwgaW52YWxpZCwgZGlzYWJsZWQsIHZhbHVlLCBtaW4sIG1heCwgZGVjcmVhc2VUZXh0LCBpbmNyZWFzZVRleHQsIC4uLnJlbWFpbmluZyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IHRoZW1hYmxlUHJvcHMsIHJlc3QgfSA9IGV4dHJhY3RUaGVtYWJsZVByb3BzKHJlbWFpbmluZyk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxCb3ggey4uLnRoZW1hYmxlUHJvcHN9IGNsYXNzTmFtZT17Y2xhc3NOYW1lfT5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuc3RlcERvd259XG4gICAgICAgICAgYXJpYS1sYWJlbD17ZGVjcmVhc2VUZXh0fVxuICAgICAgICAgIGNsYXNzTmFtZT1cIi1pbm5lci1pbnB1dC1zdGVwLWRvd24tZWxlbWVudFwiXG4gICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkIHx8ICF0aGlzLmNhbkRlY3JlYXNlKCl9XG4gICAgICAgID5cbiAgICAgICAgICA8SWNvbiBzcmM9XCJudW1iZXJJbnB1dERvd25cIiBmYWxsYmFjaz1cIuKIklwiIC8+XG4gICAgICAgIDwvYnV0dG9uPlxuXG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHJlZj17dGhpcy5tb3VudElucHV0UmVmfVxuICAgICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgICAgICBtaW49e21pbn1cbiAgICAgICAgICBtYXg9e21heH1cbiAgICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25DaGFuZ2V9XG4gICAgICAgICAgey4uLnJlc3R9XG4gICAgICAgIC8+XG5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuc3RlcFVwfVxuICAgICAgICAgIGFyaWEtbGFiZWw9e2luY3JlYXNlVGV4dH1cbiAgICAgICAgICBjbGFzc05hbWU9XCItaW5uZXItaW5wdXQtc3RlcC11cC1lbGVtZW50XCJcbiAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWQgfHwgIXRoaXMuY2FuSW5jcmVhc2UoKX1cbiAgICAgICAgPlxuICAgICAgICAgIDxJY29uIHNyYz1cIm51bWJlcklucHV0VXBcIiBmYWxsYmFjaz1cIitcIiAvPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvQm94PlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IE51bWJlcklucHV0ID0gdGhlbWVkKHtcbiAgdGFnOiBOdW1iZXJJbnB1dElubmVyRE9NLFxuXG4gIGRlZmF1bHRQcm9wczoge1xuICAgIGludmFsaWQ6IGZhbHNlLFxuICAgIG1pbjogTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLFxuICAgIG1heDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLFxuICAgIHN0ZXA6IDEsXG4gICAgaW5jcmVhc2VUZXh0OiAnSW5jcmVhc2UgUXVhbnRpdHknLFxuICAgIGRlY3JlYXNlVGV4dDogJ0RlY3JlYXNlIFF1YW50aXR5J1xuICB9LFxuXG4gIGRlZmF1bHRUaGVtZToge1xuICAgIG51bWJlcklucHV0OiB7XG4gICAgICBkaXNwbGF5OiAnaW5saW5lLWZsZXgnLFxuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBoZWlnaHQ6ICdsZycsXG5cbiAgICAgIGNzczogKHsgdGhlbWUsIGludmFsaWQgfSkgPT4gKHtcbiAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICBmbGV4OiAnbm9uZScsXG4gICAgICAgICAgd2lkdGg6IHRoZW1lLnNwYWNpbmcubGcsXG4gICAgICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICAgICAgYXBwZWFyYW5jZTogJ25vbmUnLFxuICAgICAgICAgIE1vekFwcGVhcmFuY2U6ICd0ZXh0ZmllbGQnLFxuICAgICAgICAgIGZvbnRTdHlsZTogJ2luaGVyaXQnLFxuICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgYm9yZGVyOiB0aGVtZS5ib3JkZXJzLnJlZ3VsYXIsXG4gICAgICAgICAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMubWVkaXVtLFxuICAgICAgICAgIGJvcmRlckNvbG9yOiBpbnZhbGlkID8gdGhlbWUuY29sb3JzLmVycm9yIDogdGhlbWUuY29sb3JzLnNlY29uZGFyeURhcmssXG4gICAgICAgICAgYm94U2hhZG93OiAnbm9uZScsXG4gICAgICAgICAgJzo6LXdlYmtpdC1vdXRlci1zcGluLWJ1dHRvbiw6Oi13ZWJraXQtaW5uZXItc3Bpbi1idXR0b24nOiB7XG4gICAgICAgICAgICBhcHBlYXJhbmNlOiAnbm9uZSdcbiAgICAgICAgICB9LFxuICAgICAgICAgICc6Zm9jdXMnOiB7XG4gICAgICAgICAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgICAgICAgICBib3JkZXJDb2xvcjogaW52YWxpZCA/IHRoZW1lLmNvbG9ycy5lcnJvciA6IHRoZW1lLmNvbG9ycy5zZWNvbmRhcnlcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgJy4taW5uZXItaW5wdXQtc3RlcC1kb3duLWVsZW1lbnQsIC4taW5uZXItaW5wdXQtc3RlcC11cC1lbGVtZW50Jzoge1xuICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICAgIGZsZXg6ICdub25lJyxcbiAgICAgICAgICB3aWR0aDogdGhlbWUuc3BhY2luZy5sZyxcbiAgICAgICAgICBib3JkZXI6ICdub25lJyxcbiAgICAgICAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgICAgICAgYXBwZWFyYW5jZTogJ25vbmUnLFxuICAgICAgICAgIHRyYW5zaXRpb25Qcm9wZXJ0eTogJ3RyYW5zZm9ybSwgYmFja2dyb3VuZCcsXG4gICAgICAgICAgdHJhbnNpdGlvblRpbWluZ0Z1bmN0aW9uOiB0aGVtZS5lYXNpbmdGdW5jdGlvbnMuZWFzZUluLFxuICAgICAgICAgIHRyYW5zaXRpb25EdXJhdGlvbjogdGhlbWUudHJhbnNpdGlvbkR1cmF0aW9ucy5zaG9ydCxcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5jb2xvcnMuc2Vjb25kYXJ5RGFyayxcbiAgICAgICAgICBjb2xvcjogdGhlbWUuY29sb3JzLnNlY29uZGFyeVRleHQsXG4gICAgICAgICAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMucm91bmQsXG4gICAgICAgICAgZm9udFdlaWdodDogdGhlbWUuZm9udFdlaWdodHMuYm9sZCxcbiAgICAgICAgICBmb250U2l6ZTogJ2luaGVyaXQnLFxuICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsXG4gICAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICAgICAgdHJhbnNmb3JtOiAnc2NhbGUoMC44KScsXG4gICAgICAgICAgbGluZUhlaWdodDogMSxcbiAgICAgICAgICAnOmhvdmVyJzoge1xuICAgICAgICAgICAgYmFja2dyb3VuZDogdGhlbWUuY29sb3JzLnNlY29uZGFyeVxuICAgICAgICAgIH0sXG4gICAgICAgICAgJzpkaXNhYmxlZCc6IHtcbiAgICAgICAgICAgIG9wYWNpdHk6ICcwLjUnXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAnLi1pbm5lci1pbnB1dC1zdGVwLWRvd24tZWxlbWVudCc6IHtcbiAgICAgICAgICBtYXJnaW5SaWdodDogdGhlbWUuc3BhY2luZy54cyxcbiAgICAgICAgICAnOmFjdGl2ZSc6IHtcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3NjYWxlKDAuNiknXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAnLi1pbm5lci1pbnB1dC1zdGVwLXVwLWVsZW1lbnQnOiB7XG4gICAgICAgICAgbWFyZ2luTGVmdDogdGhlbWUuc3BhY2luZy54cyxcbiAgICAgICAgICAnOmFjdGl2ZSc6IHtcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3NjYWxlKDEpJ1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cbn0pO1xuIl19