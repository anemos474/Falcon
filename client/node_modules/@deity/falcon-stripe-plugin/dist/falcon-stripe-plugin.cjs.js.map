{"version":3,"file":"falcon-stripe-plugin.cjs.js","sources":["../src/Loader.tsx","../src/StripePlugin.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Helmet } from 'react-helmet-async';\nimport { Elements, injectStripe, StripeProvider } from 'react-stripe-elements';\n\ndeclare global {\n  interface Window {\n    Stripe: any;\n  }\n}\n\nexport const withStripe = WrappedComponent => {\n  const WrappedComponentWithStripe = injectStripe(WrappedComponent);\n\n  return props => {\n    const [stripe, setStripe] = useState(null);\n    const errMessage = 'Stripe Public Key was not returned from the Server!';\n    const {\n      errorComponent,\n      config: { key }\n    } = props;\n\n    if (!key) {\n      return errorComponent ? errorComponent(errMessage) : <>{errMessage}</>;\n    }\n\n    return (\n      <>\n        <Helmet\n          onChangeClientState={() => {\n            document.querySelector('#stripe-js').addEventListener('load', () => {\n              setStripe(window.Stripe(key));\n            });\n          }}\n        >\n          <script id=\"stripe-js\" src=\"https://js.stripe.com/v3/\" async />\n        </Helmet>\n        {stripe && (\n          <StripeProvider stripe={stripe}>\n            <Elements>\n              <WrappedComponentWithStripe {...props} />\n            </Elements>\n          </StripeProvider>\n        )}\n      </>\n    );\n  };\n};\n","import React, { ReactElement } from 'react';\nimport { withStripe } from './Loader';\n\nexport type StripePluginTypes = {\n  stripe: stripe.Stripe;\n  config: any;\n  children(arg0: any): ReactElement;\n  elements: any;\n};\n\n/**\n * Testing docs - https://stripe.com/docs/testing#cards\n */\nconst StripeCard: React.FC<StripePluginTypes> = props => {\n  const { stripe, config, children } = props;\n  const { clientSecret } = config;\n  const cardElement = props.elements.getElement('card');\n\n  const payFn = async () =>\n    stripe\n      .confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: cardElement\n        }\n      })\n      .then(({ paymentIntent, error }) => {\n        if (error) {\n          return Promise.reject(new Error(error.message));\n        }\n\n        if (paymentIntent && paymentIntent.status === 'succeeded') {\n          return {\n            intentId: paymentIntent.id\n          };\n        }\n        throw new Error(`Payment failed. Status: ${paymentIntent.status}`);\n      });\n\n  return children(payFn);\n};\n\nexport const StripePlugin = withStripe(StripeCard);\n"],"names":["withStripe","WrappedComponent","WrappedComponentWithStripe","injectStripe","props","stripe","setStripe","useState","errMessage","errorComponent","config","key","React","Helmet","document","querySelector","addEventListener","window","Stripe","StripeProvider","Elements","StripeCard","children","clientSecret","cardElement","elements","getElement","payFn","confirmCardPayment","payment_method","card","then","paymentIntent","error","Promise","reject","Error","message","status","intentId","id","StripePlugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,AAUO,MAAMA,UAAU,GAAGC,gBAAgB,IAAI;QACtCC,0BAA0B,GAAGC,gCAAY,CAACF,gBAAD,CAA/C;SAEOG,KAAK,IAAI;UACR,CAACC,MAAD,EAASC,SAAT,IAAsBC,cAAQ,CAAC,IAAD,CAApC;UACMC,UAAU,GAAG,qDAAnB;UACM;MACJC,cADI;MAEJC,MAAM,EAAE;QAAEC;;QACRP,KAHJ;;QAKI,CAACO,GAAL,EAAU;aACDF,cAAc,GAAGA,cAAc,CAACD,UAAD,CAAjB,gBAAgCI,4DAAGJ,UAAH,CAArD;;;wBAIAI,yEACEA,6BAACC,uBAAD;MACE,mBAAmB,EAAE,MAAM;QACzBC,QAAQ,CAACC,aAAT,CAAuB,YAAvB,EAAqCC,gBAArC,CAAsD,MAAtD,EAA8D,MAAM;UAClEV,SAAS,CAACW,MAAM,CAACC,MAAP,CAAcP,GAAd,CAAD,CAAT;SADF;OAFJ;;;;;;oBAOEC;MAAQ,EAAE,EAAC,WAAX;MAAuB,GAAG,EAAC,2BAA3B;MAAuD,KAAK,MAA5D;;;;;;MAPF,CADF,EAUGP,MAAM,iBACLO,6BAACO,kCAAD;MAAgB,MAAM,EAAEd,MAAxB;;;;;;oBACEO,6BAACQ,4BAAD;;;;;;oBACER,6BAAC,0BAAD,eAAgCR,KAAhC;;;;;;OADF,CADF,CAXJ,CADF;GAZF;CAHK;;ACAP;;;AAGA,MAAMiB,UAAuC,GAAGjB,KAAK,IAAI;QACjD;IAAEC,MAAF;IAAUK,MAAV;IAAkBY;MAAalB,KAArC;QACM;IAAEmB;MAAiBb,MAAzB;QACMc,WAAW,GAAGpB,KAAK,CAACqB,QAAN,CAAeC,UAAf,CAA0B,MAA1B,CAApB;;QAEMC,KAAK,GAAG,YACZtB,MAAM,CACHuB,kBADH,CACsBL,YADtB,EACoC;IAChCM,cAAc,EAAE;MACdC,IAAI,EAAEN;;GAHZ,EAMGO,IANH,CAMQ,CAAC;IAAEC,aAAF;IAAiBC;GAAlB,KAA8B;QAC9BA,KAAJ,EAAW;aACFC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAUH,KAAK,CAACI,OAAhB,CAAf,CAAP;;;QAGEL,aAAa,IAAIA,aAAa,CAACM,MAAd,KAAyB,WAA9C,EAA2D;aAClD;QACLC,QAAQ,EAAEP,aAAa,CAACQ;OAD1B;;;UAII,IAAIJ,KAAJ,CAAW,2BAA0BJ,aAAa,CAACM,MAAO,EAA1D,CAAN;GAhBJ,CADF;;SAoBOhB,QAAQ,CAACK,KAAD,CAAf;CAzBF;;AA4BA,MAAac,YAAY,GAAGzC,UAAU,CAACqB,UAAD,CAA/B;;;;;;;;;;;;"}